// RUN: rm -rf %t
// RUN: mkdir -p %t/mbit/apb_avip/sim
// RUN: : > %t/mbit/apb_avip/sim/apb_compile.f
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\n: > "${OUT:?OUT is required}"\n' > %t/fake-run-avip.sh
// RUN: chmod +x %t/fake-run-avip.sh
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\ntimeout_arg=""\nfor arg in "$@"; do\n  if [[ "$arg" == --timeout=* ]]; then\n    timeout_arg="${arg#--timeout=}"\n  fi\ndone\nif [[ "$timeout_arg" != "1" ]]; then\n  echo "bad_timeout=$timeout_arg" >&2\n  exit 98\nfi\nsleep 2\necho "Simulation terminated at time 10 fs"\necho "UVM_FATAL : 0"\necho "UVM_ERROR : 0"\necho "Coverage = 100 %%%%"\necho "Coverage = 100 %%%%"\n' > %t/fake-circt-sim
// RUN: chmod +x %t/fake-circt-sim
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nexit 0\n' > %t/fake-circt-verilog
// RUN: chmod +x %t/fake-circt-verilog
// RUN: env MBIT_DIR=%t/mbit AVIPS=apb SEEDS=1 CIRCT_VERILOG=%t/fake-circt-verilog CIRCT_SIM=%t/fake-circt-sim RUN_AVIP=%t/fake-run-avip.sh COMPILE_TIMEOUT=10 SIM_TIMEOUT=1 SIM_TIMEOUT_GRACE=2 MAX_WALL_MS=100000 %S/../../utils/run_avip_circt_sim.sh %t/out > %t/log.txt 2>&1
// RUN: FileCheck %s --check-prefix=LOG < %t/log.txt
// RUN: FileCheck %s --check-prefix=META < %t/out/meta.txt
//
// LOG: [avip-circt-sim] apb seed=1 sim_status=OK sim_exit=0
// META: sim_timeout=1
// META: sim_timeout_grace=2
// META: sim_timeout_hard=3
