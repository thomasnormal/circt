// RUN: rm -rf %t && mkdir -p %t/sv-tests/tests/chapter-16
// RUN: bash -eu -c $'cat > %t/sv-tests/tests/chapter-16/16.15--smtlib-fallback.sv <<\"EOF\"\n/*\n:name: smtlib_fallback\n:description: ensures run-smtlib fallback retries with --run\n:type: simulation\n:tags: 16.15\n:unsynthesizable: 1\n*/\nmodule top(input logic clk, input logic a);\n  assert property (@(posedge clk) a);\nendmodule\nEOF\n'
// RUN: bash -eu -c $'cat > %t/fake-verilog.sh <<\"EOF\"\n#!/usr/bin/env bash\ncat <<\"MLIR\"\nmodule {\n  hw.module @top(in %clk : i1, in %a : i1) {\n    %c1 = hw.constant true : i1\n    verif.assert %c1 : i1\n    hw.output\n  }\n}\nMLIR\nEOF\nchmod +x %t/fake-verilog.sh\n'
// RUN: bash -eu -c $'cat > %t/fake-bmc.sh <<\"EOF\"\n#!/usr/bin/env bash\necho \"$*\" >> %t/bmc-args.log\nfor arg in \"$@\"; do\n  if [[ \"$arg\" == \"--run-smtlib\" ]]; then\n    echo \"fake.mlir:1:1: error: for-smtlib-export does not support LLVM dialect operations inside verif.bmc regions\" >&2\n    exit 1\n  fi\ndone\necho \"BMC_RESULT=SAT\"\nEOF\nchmod +x %t/fake-bmc.sh\n'
// RUN: env OUT=%t/out.txt BMC_RUN_SMTLIB=1 Z3_BIN=/bin/true CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh Z3_LIB=/dev/null DISABLE_UVM_AUTO_INCLUDE=1 TAG_REGEX="(^| )16\\.15( |$)" %S/../../utils/run_sv_tests_circt_bmc.sh %t/sv-tests | FileCheck %s
// RUN: cat %t/out.txt | FileCheck %s --check-prefix=OUT
// RUN: cat %t/bmc-args.log | FileCheck %s --check-prefix=ARGS

// CHECK: sv-tests SVA summary: total=1 pass=0 fail=1 xfail=0 xpass=0 error=0 skip=0
// OUT: FAIL{{[[:space:]]+}}16.15--smtlib-fallback{{[[:space:]]+}}
// ARGS: --run-smtlib
// ARGS: --shared-libs=/dev/null
