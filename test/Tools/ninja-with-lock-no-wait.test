// RUN: rm -rf %t && mkdir -p %t/build
// RUN: printf 'rule hold\n  command = /usr/bin/env bash -c "sleep 1"\nbuild hold: hold\ndefault hold\n' > %t/build/build.ninja
// RUN: bash -lc 'set -euo pipefail; %S/../../utils/ninja-with-lock.sh -C %t/build hold > %t/first.log 2>&1 & pid=$!; for _ in $(seq 1 100); do [[ -f %t/build/.circt-build.lock.owner ]] && break; sleep 0.02; done; if %S/../../utils/ninja-with-lock.sh --no-wait -C %t/build hold > %t/second.log 2>&1; then echo "expected no-wait lock failure" >&2; exit 1; fi; wait "$pid"; test ! -f %t/build/.circt-build.lock.owner'
// RUN: FileCheck %s --check-prefix=LOCK < %t/second.log

// LOCK: build lock is held:
// LOCK: owner metadata from
// LOCK: command=ninja -C {{.*}} hold
