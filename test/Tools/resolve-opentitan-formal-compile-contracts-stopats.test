// RUN: rm -rf %t
// RUN: mkdir -p %t/bin %t/ot %t/work
// RUN: printf 'target_name\tdut\tfusesoc_core\ttask\tstopats\tflow\tsub_flow\trel_path\tsource_kind\tsource_cfg_file\troot_cfg_file\nfoo_sec_cm\tfoo_tb\tlowrisc:fpv:foo_fpv\tFpvSecCm\t["*u_state_regs.state_o","*u_ctrl.state_o"]\tformal\tfpv\thw/top_earlgrey/formal/sec_cm/foo\tinline\t%t/top.hjson\t%t/top.hjson\n' > %t/manifest.tsv
// RUN: printf '#!/usr/bin/env python3\nimport pathlib,sys\ncore = sys.argv[-1]\ntool = sys.argv[sys.argv.index(\"--tool\") + 1]\ntarget = sys.argv[sys.argv.index(\"--target\") + 1]\ncore_token = core.replace(\":\", \"_\").replace(\".\", \"_\")\nout_dir = pathlib.Path.cwd() / \"build\" / core_token / f\"{target}-{tool}\"\nout_dir.mkdir(parents=True, exist_ok=True)\neda = out_dir / f\"{core_token}.eda.yml\"\neda.write_text(\"\"\"toplevel: foo_tb\\nfiles:\\n- core: lowrisc:foo:pkg:0\\n  file_type: systemVerilogSource\\n  name: ../src/foo_pkg.sv\\n\"\"\")\n' > %t/bin/fusesoc
// RUN: chmod +x %t/bin/fusesoc
// RUN: python3 %S/../../utils/resolve_opentitan_formal_compile_contracts.py --manifest %t/manifest.tsv --opentitan-root %t/ot --out-contracts %t/contracts.tsv --workdir %t/work --fusesoc-bin %t/bin/fusesoc
// RUN: FileCheck %s < %t/contracts.tsv
//
// CHECK: #opentitan_compile_contract_schema_version=1
// CHECK: target_name{{[[:space:]]+}}fusesoc_core{{[[:space:]]+}}task{{[[:space:]]+}}flow{{[[:space:]]+}}sub_flow{{[[:space:]]+}}rel_path
// CHECK: stopat_count{{[[:space:]]+}}stopats_fingerprint
// CHECK: foo_sec_cm{{[[:space:]]+}}lowrisc:fpv:foo_fpv{{[[:space:]]+}}FpvSecCm{{[[:space:]]+}}formal{{[[:space:]]+}}fpv{{[[:space:]]+}}hw/top_earlgrey/formal/sec_cm/foo
// CHECK: foo_tb{{[[:space:]]+}}ok{{[[:space:]]+}}1{{[[:space:]]+}}0{{[[:space:]]+}}0{{[[:space:]]+}}{{[0-9a-f]+}}{{[[:space:]]+}}{{[0-9a-f]+}}{{[[:space:]]+}}{{[0-9a-f]+}}{{[[:space:]]+}}{{[0-9a-f]+}}{{[[:space:]]+}}2{{[[:space:]]+}}{{[0-9a-f]+}}
