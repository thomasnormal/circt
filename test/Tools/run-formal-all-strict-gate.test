// RUN: rm -rf %t
// RUN: mkdir -p %t/utils %t/sv-tests %t/verilator %t/yosys %t/avip/foo_avip
// RUN: cp %S/../../utils/run_formal_all.sh %t/utils/run_formal_all.sh
//
// RUN: printf '#!/usr/bin/env bash\necho "sv-tests SVA summary: total=10 pass=9 fail=0 xfail=1 xpass=0 error=0 skip=0"\n' > %t/utils/run_sv_tests_circt_bmc.sh
// RUN: printf '#!/usr/bin/env bash\necho "sv-tests LEC summary: total=10 pass=10 fail=0 error=0 skip=0"\n' > %t/utils/run_sv_tests_circt_lec.sh
// RUN: printf '#!/usr/bin/env bash\necho "verilator-verification summary: total=10 pass=10 fail=0 xfail=0 xpass=0 error=0 skip=0"\n' > %t/utils/run_verilator_verification_circt_bmc.sh
// RUN: printf '#!/usr/bin/env bash\necho "verilator-verification LEC summary: total=10 pass=10 fail=0 error=0 skip=0"\n' > %t/utils/run_verilator_verification_circt_lec.sh
// RUN: printf '#!/usr/bin/env bash\necho "yosys SVA summary: 4 tests, failures=0, xfail=0, xpass=0, skipped=0"\n' > %t/utils/run_yosys_sva_circt_bmc.sh
// RUN: printf '#!/usr/bin/env bash\necho "yosys LEC summary: total=4 pass=4 fail=0 error=0 skip=0"\n' > %t/utils/run_yosys_sva_circt_lec.sh
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nif [[ \"${CIRCT_VERILOG:-}\" != \"%t/fake-circt-verilog\" ]]; then\n  echo \"bad_CIRCT_VERILOG=${CIRCT_VERILOG:-}\"\n  exit 8\nfi\necho \"CIRCT_VERILOG_OK\"\n' > %t/utils/run_avip_circt_verilog.sh
// RUN: printf '#!/usr/bin/env bash\nexit 0\n' > %t/fake-circt-verilog
// RUN: chmod +x %t/utils/run_formal_all.sh %t/utils/run_sv_tests_circt_bmc.sh %t/utils/run_sv_tests_circt_lec.sh %t/utils/run_verilator_verification_circt_bmc.sh %t/utils/run_verilator_verification_circt_lec.sh %t/utils/run_yosys_sva_circt_bmc.sh %t/utils/run_yosys_sva_circt_lec.sh %t/utils/run_avip_circt_verilog.sh %t/fake-circt-verilog
//
// RUN: cd %t && utils/run_formal_all.sh --out-dir %t/out-base --sv-tests %t/sv-tests --verilator %t/verilator --yosys %t/yosys --baseline-file %t/formal-baselines.tsv --update-baselines --json-summary %t/out-base/summary.json
// RUN: FileCheck %s --check-prefix=JSON < %t/out-base/summary.json
// RUN: FileCheck %s --check-prefix=BASELINE < %t/formal-baselines.tsv
// RUN: cd %t && utils/run_formal_all.sh --out-dir %t/out-avip --sv-tests %t/sv-tests --verilator %t/verilator --yosys %t/yosys --with-avip --avip-glob %t/avip/* --circt-verilog %t/fake-circt-verilog
// RUN: FileCheck %s --check-prefix=AVIPPATH < %t/out-avip/summary.tsv
// RUN: FileCheck %s --check-prefix=AVIPENV < %t/out-avip/avip-foo_avip.log
//
// RUN: printf '#!/usr/bin/env bash\necho "verilator-verification summary: total=10 pass=10 fail=0 xfail=0 xpass=1 error=0 skip=0"\n' > %t/utils/run_verilator_verification_circt_bmc.sh
// RUN: chmod +x %t/utils/run_verilator_verification_circt_bmc.sh
// RUN: not sh -c 'cd %t && utils/run_formal_all.sh --out-dir %t/out-xpass --sv-tests %t/sv-tests --verilator %t/verilator --yosys %t/yosys --baseline-file %t/formal-baselines.tsv --strict-gate' 2>&1 | FileCheck %s --check-prefix=STRICTXPASS
//
// RUN: printf '#!/usr/bin/env bash\necho "verilator-verification summary: total=10 pass=10 fail=0 xfail=0 xpass=0 error=0 skip=0"\n' > %t/utils/run_verilator_verification_circt_bmc.sh
// RUN: printf '#!/usr/bin/env bash\necho "sv-tests LEC summary: total=10 pass=8 fail=0 error=0 skip=0"\n' > %t/utils/run_sv_tests_circt_lec.sh
// RUN: chmod +x %t/utils/run_verilator_verification_circt_bmc.sh %t/utils/run_sv_tests_circt_lec.sh
// RUN: not sh -c 'cd %t && utils/run_formal_all.sh --out-dir %t/out-rate --sv-tests %t/sv-tests --verilator %t/verilator --yosys %t/yosys --baseline-file %t/formal-baselines.tsv --fail-on-passrate-regression' 2>&1 | FileCheck %s --check-prefix=STRICTRATE
//
// RUN: printf '9999-12-31\tsv-tests\tLEC\t10\t8\t0\t0\t0\t0\t0\t80.000\ttotal=10 pass=8 fail=0 xfail=0 xpass=0 error=0 skip=0\n' >> %t/formal-baselines.tsv
// RUN: printf '#!/usr/bin/env bash\necho "sv-tests LEC summary: total=10 pass=9 fail=0 error=0 skip=0"\n' > %t/utils/run_sv_tests_circt_lec.sh
// RUN: chmod +x %t/utils/run_sv_tests_circt_lec.sh
// RUN: not sh -c 'cd %t && utils/run_formal_all.sh --out-dir %t/out-window --sv-tests %t/sv-tests --verilator %t/verilator --yosys %t/yosys --baseline-file %t/formal-baselines.tsv --fail-on-passrate-regression --baseline-window 2' 2>&1 | FileCheck %s --check-prefix=STRICTWINDOW
//
// JSON: "rows"
// JSON: "suite": "sv-tests"
// JSON: "mode": "BMC"
// JSON: "pass_rate":
// BASELINE: date{{[[:space:]]+}}suite{{[[:space:]]+}}mode{{[[:space:]]+}}total{{[[:space:]]+}}pass{{[[:space:]]+}}fail{{[[:space:]]+}}xfail{{[[:space:]]+}}xpass{{[[:space:]]+}}error{{[[:space:]]+}}skip{{[[:space:]]+}}pass_rate{{[[:space:]]+}}result
// BASELINE: sv-tests{{[[:space:]]+}}BMC{{[[:space:]]+}}10{{[[:space:]]+}}9{{[[:space:]]+}}0{{[[:space:]]+}}1{{[[:space:]]+}}0{{[[:space:]]+}}0{{[[:space:]]+}}0{{[[:space:]]+}}100.000{{[[:space:]]+}}total=10 pass=9 fail=0 xfail=1 xpass=0 error=0 skip=0
// AVIPPATH: avip/foo_avip{{[[:space:]]+}}compile{{[[:space:]]+}}1{{[[:space:]]+}}1{{[[:space:]]+}}0
// AVIPENV: CIRCT_VERILOG_OK
//
// STRICTXPASS: strict gate failures:
// STRICTXPASS: verilator-verification BMC: xpass increased (0 -> 1, window=1)
//
// STRICTRATE: strict gate failures:
// STRICTRATE: sv-tests LEC: pass_rate regressed (100.000 -> 80.000, window=1)
//
// STRICTWINDOW: strict gate failures:
// STRICTWINDOW: sv-tests LEC: pass_rate regressed (100.000 -> 90.000, window=2)
