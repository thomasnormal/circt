// RUN: rm -rf %t
// RUN: mkdir -p %t/utils
// RUN: cp %S/../../utils/run_formal_cadence.sh %t/utils/run_formal_cadence.sh
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nOUT_DIR=\"\"\nwhile [[ $# -gt 0 ]]; do\n  if [[ \"$1\" == \"--out-dir\" ]]; then OUT_DIR=\"$2\"; shift 2; continue; fi\n  shift\ndone\nmkdir -p \"$OUT_DIR\"\nprintf \"ok\\n\" > \"$OUT_DIR/ok.txt\"\n' > %t/utils/fake-formal-all.sh
// RUN: chmod +x %t/utils/run_formal_cadence.sh %t/utils/fake-formal-all.sh
// RUN: cd %t && utils/run_formal_cadence.sh --interval-secs 0 --iterations 2 --run-formal-all %t/utils/fake-formal-all.sh --strict-gate
// RUN: test -d %t/formal-cadence-results-*/run-0001-*
// RUN: test -d %t/formal-cadence-results-*/run-0002-*
// RUN: cat %t/formal-cadence-results-*/cadence.log | FileCheck %s --check-prefix=PASSLOG
//
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nSTATE_FILE=\"%t/fail-counter.txt\"\ncount=0\nif [[ -f \"$STATE_FILE\" ]]; then count=$(cat \"$STATE_FILE\"); fi\ncount=$((count + 1))\necho \"$count\" > \"$STATE_FILE\"\nif [[ \"$count\" -ge 2 ]]; then\n  echo \"forced failure\"\n  exit 3\nfi\nexit 0\n' > %t/utils/fake-formal-all-fail.sh
// RUN: chmod +x %t/utils/fake-formal-all-fail.sh
// RUN: not sh -c 'cd %t && utils/run_formal_cadence.sh --interval-secs 0 --iterations 3 --run-formal-all %t/utils/fake-formal-all-fail.sh --no-strict-gate' 2>&1 | FileCheck %s --check-prefix=FAILFAST
//
// PASSLOG: completed_iterations=2
// FAILFAST: failing fast: iteration 2 failed
