// RUN: rm -rf %t
// RUN: mkdir -p %t/utils %t/src %t/work
// RUN: cp %S/../../utils/run_opentitan_fpv_circt_bmc.py %t/utils/run_opentitan_fpv_circt_bmc.py
// RUN: printf '#!/usr/bin/env python3\nimport pathlib,sys\ncases=\"\"\nout=\"\"\nargs=sys.argv[1:]\ni=0\nwhile i < len(args):\n  if args[i]==\"--cases-file\":\n    cases=args[i+1]\n    i += 2\n    continue\n  if args[i]==\"--results-file\":\n    out=args[i+1]\n    i += 2\n    continue\n  i += 1\nif not cases or not out:\n  raise SystemExit(10)\nrows=[]\nfor line in pathlib.Path(cases).read_text(encoding=\"utf-8\").splitlines():\n  line=line.strip()\n  if not line:\n    continue\n  parts=line.split(\"\\t\")\n  case_id=parts[0]\n  case_path=parts[4]\n  rows.append(f\"PASS\\t{case_id}\\t{case_path}\\topentitan\\tFPV_BMC\\tUNSAT\")\npathlib.Path(out).write_text(\"\\n\".join(rows)+\"\\n\", encoding=\"utf-8\")\n' > %t/utils/run_pairwise_circt_bmc.py
// RUN: chmod +x %t/utils/run_opentitan_fpv_circt_bmc.py %t/utils/run_pairwise_circt_bmc.py
// RUN: touch %t/src/foo.sv
// RUN: printf '#opentitan_compile_contract_schema_version=1\ntarget_name\tfusesoc_core\ttask\tflow\tsub_flow\trel_path\ttoplevel\tsetup_status\tfile_count\tinclude_dir_count\tdefine_count\tfiles_fingerprint\tinclude_dirs_fingerprint\tdefines_fingerprint\tcontract_fingerprint\tstopat_count\tstopats_fingerprint\tstopats\ttask_profile\ttask_known\tstopat_mode\tblackbox_policy\ttask_policy_fingerprint\tfiles\tinclude_dirs\tdefines\teda_yml_path\tsetup_log_path\tworkdir\na_fpv\tlowrisc:fpv:a_fpv\tFpvDefault\tformal\tfpv\thw/top_earlgrey/formal/ip/a\ta_tb\tok\t1\t0\t0\tf\ti\td\tc\t0\ts\t\tfpv_default\t1\tnone\tnone\tp\t%t/src/foo.sv\t\t\t/tmp/a.eda.yml\t/tmp/a.log\t/tmp/a.work\nb_fpv\tlowrisc:fpv:b_fpv\tFpvDefault\tformal\tfpv\thw/top_earlgrey/formal/ip/b\tb_tb\tok\t1\t0\t0\tf\ti\td\tc\t0\ts\t\tfpv_default\t1\tnone\tnone\tp\t%t/src/foo.sv\t\t\t/tmp/b.eda.yml\t/tmp/b.log\t/tmp/b.work\nc_fpv\tlowrisc:fpv:c_fpv\tFpvDefault\tformal\tfpv\thw/top_earlgrey/formal/ip/c\tc_tb\tok\t1\t0\t0\tf\ti\td\tc\t0\ts\t\tfpv_default\t1\tnone\tnone\tp\t%t/src/foo.sv\t\t\t/tmp/c.eda.yml\t/tmp/c.log\t/tmp/c.work\nd_fpv\tlowrisc:fpv:d_fpv\tFpvDefault\tformal\tfpv\thw/top_earlgrey/formal/ip/d\td_tb\tok\t1\t0\t0\tf\ti\td\tc\t0\ts\t\tfpv_default\t1\tnone\tnone\tp\t%t/src/foo.sv\t\t\t/tmp/d.eda.yml\t/tmp/d.log\t/tmp/d.work\n' > %t/contracts.tsv
// RUN: sh -c 'OUT=%t/results.tsv %t/utils/run_opentitan_fpv_circt_bmc.py --compile-contracts %t/contracts.tsv --workdir %t/work --target-shard-count 2 --target-shard-index 1' 2>&1 | FileCheck %s --check-prefix=LOG
// RUN: FileCheck %s --check-prefix=ROWS < %t/results.tsv
//
// LOG: opentitan FPV BMC shard selection: shard=1/2 selected_targets=2 total_targets=4
// LOG: opentitan FPV BMC summary: total=2 pass=2 fail=0 xfail=0 xpass=0 error=0 skip=0
// ROWS: PASS{{[[:space:]]+}}b_fpv::b_tb{{[[:space:]]+}}hw/top_earlgrey/formal/ip/b/b_tb{{[[:space:]]+}}opentitan{{[[:space:]]+}}FPV_BMC{{[[:space:]]+}}UNSAT
// ROWS: PASS{{[[:space:]]+}}d_fpv::d_tb{{[[:space:]]+}}hw/top_earlgrey/formal/ip/d/d_tb{{[[:space:]]+}}opentitan{{[[:space:]]+}}FPV_BMC{{[[:space:]]+}}UNSAT
