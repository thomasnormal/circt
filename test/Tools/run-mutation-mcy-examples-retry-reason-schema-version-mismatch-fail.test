// RUN: rm -rf %t && mkdir -p %t/examples/bitcnt %t/bin
// RUN: printf 'module bitcnt(input logic a, output logic y); assign y = a; endmodule\n' > %t/examples/bitcnt/bitcnt.v
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nsubcmd="$1"\nshift\nif [[ "$subcmd" != "cover" ]]; then\n  echo "expected cover subcommand" >&2\n  exit 9\nfi\nwork_dir=""\nwhile [[ $# -gt 0 ]]; do\n  case "$1" in\n    --work-dir) work_dir="$2"; shift 2 ;;&\n    --work-dir=*) work_dir="${1#*=}"; shift ;;&\n    *) shift ;;&\n  esac\ndone\nmkdir -p "$work_dir"\nprintf "detected_mutants\\t1\\nrelevant_mutants\\t1\\nerrors\\t0\\n" > "$work_dir/metrics.tsv"\n' > %t/bin/circt-mut
// RUN: chmod +x %t/bin/circt-mut
// RUN: printf 'retry_reason\tretries\npermission_denied\t0\n' > %t/retry-baseline.tsv
// RUN: printf 'v0\n' > %t/retry-baseline.tsv.schema-version
// RUN: printf '0000000000000000000000000000000000000000000000000000000000000000\n' > %t/retry-baseline.tsv.schema-contract

// RUN: not %S/../../utils/run_mutation_mcy_examples.sh \
// RUN:   --examples-root %t/examples \
// RUN:   --example bitcnt \
// RUN:   --smoke \
// RUN:   --circt-mut %t/bin/circt-mut \
// RUN:   --retry-reason-baseline-file %t/retry-baseline.tsv \
// RUN:   --fail-on-retry-reason-diff \
// RUN:   --out-dir %t/out 2>&1 | FileCheck %s --check-prefix=ERR

// RUN: FileCheck %s --check-prefix=DRIFT < %t/out/retry-reason-drift.tsv

// ERR: Retry-reason drift failure: see
// DRIFT: example{{[[:space:]]}}metric{{[[:space:]]}}baseline{{[[:space:]]}}current{{[[:space:]]}}outcome{{[[:space:]]}}detail
// DRIFT: __baseline__{{[[:space:]]}}retry_reason_schema_version{{[[:space:]]}}v0{{[[:space:]]}}v1{{[[:space:]]}}regression{{[[:space:]]}}retry_reason_schema_version_mismatch
// DRIFT: __baseline__{{[[:space:]]}}retry_reason_schema_contract{{[[:space:]]}}0000000000000000000000000000000000000000000000000000000000000000{{[[:space:]]}}{{.+}}{{[[:space:]]}}regression{{[[:space:]]}}retry_reason_schema_contract_mismatch
