// RUN: rm -rf %t
// RUN: mkdir -p %t/utils %t/sv-tests %t/verilator %t/yosys
// RUN: cp %S/../../utils/run_formal_all.sh %t/utils/run_formal_all.sh
// RUN: printf '#!/usr/bin/env bash\necho "sv-tests SVA summary: total=1 pass=1 fail=0 xfail=0 xpass=0 error=0 skip=0"\n' > %t/utils/run_sv_tests_circt_bmc.sh
// RUN: printf '#!/usr/bin/env bash\necho "sv-tests LEC summary: total=1 pass=1 fail=0 error=0 skip=0"\n' > %t/utils/run_sv_tests_circt_lec.sh
// RUN: printf '#!/usr/bin/env bash\necho "verilator-verification summary: total=1 pass=1 fail=0 xfail=0 xpass=0 error=0 skip=0"\n' > %t/utils/run_verilator_verification_circt_bmc.sh
// RUN: printf '#!/usr/bin/env bash\necho "verilator-verification LEC summary: total=1 pass=1 fail=0 error=0 skip=0"\n' > %t/utils/run_verilator_verification_circt_lec.sh
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nout=\"${OUT:-}\"\nif [[ -z \"$out\" ]]; then\n  echo missing_OUT\n  exit 7\nfi\nmkdir -p \"$(dirname \"$out\")\"\nprintf \"FAIL\\tbasic02\\t/tmp/fake-yosys/basic02\\tyosys/tests/sva\\tBMC\\n\" > \"$out\"\necho \"yosys SVA summary: 1 tests, failures=1, xfail=0, xpass=0, skipped=0\"\n' > %t/utils/run_yosys_sva_circt_bmc.sh
// RUN: printf '#!/usr/bin/env bash\necho "yosys LEC summary: total=1 pass=1 fail=0 error=0 skip=0"\n' > %t/utils/run_yosys_sva_circt_lec.sh
// RUN: chmod +x %t/utils/run_formal_all.sh %t/utils/run_sv_tests_circt_bmc.sh %t/utils/run_sv_tests_circt_lec.sh %t/utils/run_verilator_verification_circt_bmc.sh %t/utils/run_verilator_verification_circt_lec.sh %t/utils/run_yosys_sva_circt_bmc.sh %t/utils/run_yosys_sva_circt_lec.sh
//
// RUN: printf 'suite\tmode\tid\tid_kind\tstatus\texpires_on\treason\nyosys/tests/sva\tBMC\tbasic02\tbase\tFAIL\t2099-12-31\tknown_yosys_bmc\n' > %t/expected-cases.tsv
// RUN: cd %t && utils/run_formal_all.sh --out-dir %t/out-match --sv-tests %t/sv-tests --verilator %t/verilator --yosys %t/yosys --include-lane-regex '^yosys/tests/sva/BMC$' --yosys-lec-test-filter ".*" --verilator-lec-test-filter ".*" --verilator-bmc-test-filter ".*" --sv-tests-uvm-bmc-semantics-test-filter ".*" --sv-tests-lec-test-filter ".*" --sv-tests-bmc-test-filter ".*" --yosys-bmc-test-filter '.*' --expected-failure-cases-file %t/expected-cases.tsv --fail-on-unexpected-failure-cases --fail-on-unmatched-expected-failure-cases
// RUN: FileCheck %s --check-prefix=MATCHSUM < %t/out-match/expected-failure-cases-summary.tsv
//
// RUN: printf 'suite\tmode\tid\tid_kind\tstatus\texpires_on\treason\n' > %t/refreshed-cases.tsv
// RUN: cd %t && utils/run_formal_all.sh --out-dir %t/out-refresh --sv-tests %t/sv-tests --verilator %t/verilator --yosys %t/yosys --include-lane-regex '^yosys/tests/sva/BMC$' --yosys-lec-test-filter ".*" --verilator-lec-test-filter ".*" --verilator-bmc-test-filter ".*" --sv-tests-uvm-bmc-semantics-test-filter ".*" --sv-tests-lec-test-filter ".*" --sv-tests-bmc-test-filter ".*" --yosys-bmc-test-filter '.*' --refresh-expected-failure-cases-file %t/refreshed-cases.tsv --refresh-expected-failure-cases-default-expires-on 2099-12-31 --refresh-expected-failure-cases-include-suite-regex '^yosys/tests/sva$' --refresh-expected-failure-cases-include-mode-regex '^BMC$'
// RUN: FileCheck %s --check-prefix=REFRESH < %t/refreshed-cases.tsv
//
// MATCHSUM: suite{{[[:space:]]+}}mode{{[[:space:]]+}}id_kind{{[[:space:]]+}}id
// MATCHSUM: yosys/tests/sva{{[[:space:]]+}}BMC{{[[:space:]]+}}base{{[[:space:]]+}}basic02{{[[:space:]]+}}FAIL{{[[:space:]]+}}2099-12-31{{[[:space:]]+}}1{{[[:space:]]+}}no{{[[:space:]]+}}known_yosys_bmc
//
// REFRESH: suite{{[[:space:]]+}}mode{{[[:space:]]+}}id{{[[:space:]]+}}id_kind{{[[:space:]]+}}status{{[[:space:]]+}}expires_on{{[[:space:]]+}}reason
// REFRESH: yosys/tests/sva{{[[:space:]]+}}BMC{{[[:space:]]+}}basic02{{[[:space:]]+}}base{{[[:space:]]+}}FAIL{{[[:space:]]+}}2099-12-31
