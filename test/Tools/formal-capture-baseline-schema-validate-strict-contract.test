// RUN: rm -rf %t
// RUN: mkdir -p %t/bin
// RUN: printf '#!/usr/bin/env python3\nimport json\nimport os\nfrom pathlib import Path\nrows = [\n  {\n    "schema_version": 1,\n    "suite": "toy",\n    "mode": "LEC",\n    "case_id": "z_case",\n    "case_path": "/tmp/z_case.sv",\n    "status": "PASS",\n    "reason_code": "",\n    "stage": "result",\n    "solver": "z3",\n    "solver_time_ms": 1,\n    "frontend_time_ms": 1,\n    "log_path": "",\n    "artifact_dir": ""\n  },\n  {\n    "schema_version": 1,\n    "suite": "toy",\n    "mode": "LEC",\n    "case_id": "a_case",\n    "case_path": "/tmp/a_case.sv",\n    "status": "PASS",\n    "reason_code": "",\n    "stage": "result",\n    "solver": "z3",\n    "solver_time_ms": 1,\n    "frontend_time_ms": 1,\n    "log_path": "",\n    "artifact_dir": ""\n  }\n]\nPath(os.environ["FORMAL_RESULTS_JSONL_OUT"]).write_text("\\n".join(json.dumps(row) for row in rows) + "\\n", encoding="utf-8")\nPath(os.environ["OUT"]).write_text("PASS\\tcase0\\t/tmp/case0.sv\\n", encoding="utf-8")\n' > %t/bin/fake_unsorted_schema_runner.py
// RUN: chmod +x %t/bin/fake_unsorted_schema_runner.py
// RUN: python3 %S/../../utils/formal/write_baseline_manifest.py --out %t/manifest.json --baseline-id ws0-schema-validation-strict-contract --command suite=toy --command mode=LEC --command id=unsorted_case --command cwd=%t --command command='python3 bin/fake_unsorted_schema_runner.py'
// RUN: python3 %S/../../utils/formal/capture_formal_baseline.py --manifest %t/manifest.json --out-dir %t/out-loose --repeat 1 --validate-results-schema --stop-on-command-failure
// RUN: python3 -c "import csv; row = next(csv.DictReader(open('%t/out-loose/execution.tsv', encoding='utf-8'), delimiter='\\t')); assert row['returncode'] == '0'; assert row['schema_validation_rc'] == '0'"
// RUN: not python3 %S/../../utils/formal/capture_formal_baseline.py --manifest %t/manifest.json --out-dir %t/out-strict --repeat 1 --validate-results-schema --validate-results-schema-strict-contract --stop-on-command-failure
// RUN: python3 -c "import csv; row = next(csv.DictReader(open('%t/out-strict/execution.tsv', encoding='utf-8'), delimiter='\\t')); assert row['returncode'] == '0'; assert row['schema_validation_rc'] == '1'"
