// RUN: rm -rf %t && mkdir -p %t
// RUN: echo 'module top(input logic clk); logic a; assign a = 1'\''b1; assert property (@(posedge clk) a); endmodule' > %t/simple.sv
// RUN: echo '#!/usr/bin/env bash' > %t/fake-verilog.sh && echo 'echo "// dummy mlir"' >> %t/fake-verilog.sh
// RUN: echo '#!/usr/bin/env bash' > %t/fake-bmc.sh && echo 'exit 0' >> %t/fake-bmc.sh
// RUN: chmod +x %t/fake-verilog.sh %t/fake-bmc.sh
// RUN: printf 'ghost\tpass\tknown\tpass\nghost\tpass\tknown\tpass\nghost\tpass\tknown\txfail\n*\t*\t*\tpass\nsimple\t*\t*\tpass\nsimple\tpass\txprop\tfail\n' > %t/expect.txt
// RUN: not env CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh \
// RUN:   Z3_LIB=/dev/null EXPECT_FILE=%t/expect.txt XFAIL_FILE=/dev/null \
// RUN:   BMC_SMOKE_ONLY=1 DISABLE_UVM_AUTO_INCLUDE=1 SKIP_VHDL=0 \
// RUN:   SKIP_FAIL_WITHOUT_MACRO=1 EXPECT_LINT=1 EXPECT_LINT_FAIL_ON_ISSUES=1 \
// RUN:   EXPECT_LINT_FIXES_FILE=%t/fixes.tsv \
// RUN:   %S/../../utils/run_yosys_sva_circt_bmc.sh %t > %t/out.txt
// RUN: FileCheck %s --check-prefix=OUT < %t/out.txt
// RUN: sed 's/\t/|/g' %t/fixes.tsv | FileCheck %s --check-prefix=FIX

// OUT-DAG: EXPECT_LINT(redundant): {{.*expect.txt}} row duplicates ghost|pass|known = pass
// OUT-DAG: EXPECT_LINT(conflict): {{.*expect.txt}} row redefines ghost|pass|known: pass -> xfail
// OUT-DAG: EXPECT_LINT(unknown-test): EXPECT_FILE references missing test 'ghost' via key ghost|pass|known
// OUT-DAG: EXPECT_LINT(shadowed): EXPECT_FILE wildcard key *|*|* is never selected for suite matrix
// OUT-DAG: EXPECT_LINT(ambiguity): EXPECT_FILE precedence-sensitive overlap: simple|pass|xprop (fail) overrides simple|*|* (pass) for 1 tuple(s), e.g. simple|pass|xprop
// OUT: EXPECT_LINT_SUMMARY: issues=5

// FIX: kind|source|action|key|row|note
// FIX-DAG: redundant|{{.*expect.txt}}|drop-row|ghost|pass|known||remove duplicated row
// FIX-DAG: conflict|{{.*expect.txt}}|set-row|ghost|pass|known|ghost|pass|known|xfail|keep final assignment and remove earlier conflicting rows
// FIX-DAG: unknown-test|EXPECT_FILE|drop-row|ghost|pass|known||row targets a non-existent suite test
// FIX-DAG: shadowed|EXPECT_FILE|drop-row|*|*|*||wildcard row is never selected under precedence
// FIX-DAG: ambiguity|EXPECT_FILE|add-row|simple|*|*|simple|pass|known|pass|preserve lower-precedence intent on explicit tuple
// FIX-DAG: ambiguity|EXPECT_FILE|set-row|simple|*|*|simple|*|*|fail|align lower-precedence row with overriding row simple|pass|xprop
