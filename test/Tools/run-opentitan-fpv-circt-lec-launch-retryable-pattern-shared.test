// RUN: rm -rf %t
// RUN: mkdir -p %t/bin %t/src
// RUN: printf '#opentitan_compile_contract_schema_version=1\ntarget_name\tsetup_status\ttoplevel\tfiles\tinclude_dirs\tdefines\nfoo_fpv\tok\tfoo_tb\t%t/src/foo.sv\t%t/src\tFORMAL=1\n' > %t/contracts.tsv
// RUN: printf 'PROVEN\tfoo_fpv::foo_tb\t%t/work/foo_tb\ta0000\tline_10\tUNSAT\tunsat\n' > %t/bmc-assertions.tsv
// RUN: printf 'module foo_tb; endmodule\n' > %t/src/foo.sv
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nstamp=\"${TMP_STAMP:?}\"\nif [[ ! -f \"$stamp\" ]]; then\n  echo \"stale file handle\" >&2\n  : > \"$stamp\"\n  exit 1\nfi\necho \"module { hw.module @foo_tb() }\"\n' > %t/bin/circt-verilog
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nin=\"\"; out=\"\"; for ((i=1; i<=$#; ++i)); do\n  if [[ \"${!i}\" == \"-o\" ]]; then j=$((i+1)); out=\"${!j}\"; fi\n  if [[ \"${!i}\" != -* && -z \"$in\" ]]; then in=\"${!i}\"; fi\ndone\ncp \"$in\" \"$out\"\n' > %t/bin/circt-opt
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\necho \"LEC_RESULT=EQ\"\n' > %t/bin/circt-lec
// RUN: chmod +x %t/bin/circt-verilog %t/bin/circt-opt %t/bin/circt-lec
// RUN: env FORMAL_LAUNCH_RETRY_ATTEMPTS=2 FORMAL_LAUNCH_RETRY_BACKOFF_SECS=0 FORMAL_LAUNCH_RETRYABLE_EXIT_CODES= FORMAL_LAUNCH_RETRYABLE_PATTERNS='stale file handle' TMP_STAMP=%t/retry.stamp LEC_RUN_SMTLIB=0 CIRCT_VERILOG=%t/bin/circt-verilog CIRCT_OPT=%t/bin/circt-opt CIRCT_LEC=%t/bin/circt-lec python3 %S/../../utils/run_opentitan_fpv_circt_lec.py --compile-contracts %t/contracts.tsv --bmc-assertion-results %t/bmc-assertions.tsv --results-file %t/lec-results.tsv --assertion-results-file %t/lec-assertions.tsv --workdir %t/workdir
// RUN: test -f %t/retry.stamp
// RUN: FileCheck %s --check-prefix=CASE < %t/lec-results.tsv
//
// CASE: PASS{{[[:space:]]+}}foo_fpv::foo_tb{{[[:space:]]+}}{{.*}}{{[[:space:]]+}}opentitan{{[[:space:]]+}}FPV_LEC{{[[:space:]]+}}LEC_RESULT_EQ{{[[:space:]]+}}eq
