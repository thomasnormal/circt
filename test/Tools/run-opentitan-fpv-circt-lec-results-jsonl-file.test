// RUN: rm -rf %t
// RUN: mkdir -p %t/utils %t/bin %t/src
// RUN: cp %S/../../utils/run_opentitan_fpv_circt_lec.py %t/utils/run_opentitan_fpv_circt_lec.py
// RUN: printf '#opentitan_compile_contract_schema_version=1\ntarget_name\tsetup_status\ttoplevel\tfiles\tinclude_dirs\tdefines\nfoo_fpv\tok\tfoo_tb\t%t/src/foo.sv\t%t/src\tFORMAL=1\n' > %t/contracts.tsv
// RUN: printf 'PROVEN\tfoo_fpv::foo_tb\t%t/work/foo_tb\ta0000\tline_10\tUNSAT\tunsat\n' > %t/bmc-assertions.tsv
// RUN: printf 'module foo_tb; endmodule\n' > %t/src/foo.sv
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\necho \"module { hw.module @foo_tb() }\"\n' > %t/bin/circt-verilog
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nin=\"\"; out=\"\"; for ((i=1; i<=$#; ++i)); do\n  if [[ \"${!i}\" == \"-o\" ]]; then j=$((i+1)); out=\"${!j}\"; fi\n  if [[ \"${!i}\" != -* && -z \"$in\" ]]; then in=\"${!i}\"; fi\ndone\ncp \"$in\" \"$out\"\n' > %t/bin/circt-opt
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\necho \"LEC_RESULT=EQ\"\n' > %t/bin/circt-lec
// RUN: chmod +x %t/utils/run_opentitan_fpv_circt_lec.py %t/bin/circt-verilog %t/bin/circt-opt %t/bin/circt-lec
// RUN: env LEC_RUN_SMTLIB=1 Z3_BIN=/bin/true CIRCT_VERILOG=%t/bin/circt-verilog CIRCT_OPT=%t/bin/circt-opt CIRCT_LEC=%t/bin/circt-lec python3 %t/utils/run_opentitan_fpv_circt_lec.py --compile-contracts %t/contracts.tsv --bmc-assertion-results %t/bmc-assertions.tsv --results-file %t/lec-results.tsv --assertion-results-file %t/lec-assertions.tsv --results-jsonl-file %t/results.jsonl --workdir %t/workdir
// RUN: python3 -c "import json; rows=[json.loads(line) for line in open('%t/results.jsonl', encoding='utf-8') if line.strip()]; assert len(rows)==1; row=rows[0]; assert row['suite']=='opentitan'; assert row['mode']=='FPV_LEC'; assert row['case_id']=='foo_fpv::foo_tb'; assert row['status']=='PASS'; assert row['reason_code']=='EQ'; assert row['solver']=='z3'; assert row['stage']=='result'; assert isinstance(row['solver_time_ms'], int); assert isinstance(row['frontend_time_ms'], int); assert row['log_path'].endswith('/circt-lec.log'); assert row['artifact_dir'].endswith('/foo_fpv/foo_tb')"
