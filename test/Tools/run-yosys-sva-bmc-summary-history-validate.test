// RUN: rm -rf %t && mkdir -p %t
// RUN: echo 'module top(input logic clk); logic a; assign a = 1'\''b1; assert property (@(posedge clk) a); endmodule' > %t/simple.sv
// RUN: echo '#!/usr/bin/env bash' > %t/fake-verilog.sh && echo 'echo "// dummy mlir"' >> %t/fake-verilog.sh
// RUN: echo '#!/usr/bin/env bash' > %t/fake-bmc.sh && echo 'exit 0' >> %t/fake-bmc.sh
// RUN: chmod +x %t/fake-verilog.sh %t/fake-bmc.sh
// RUN: printf 'simple\t*\t*\tpass\n' > %t/expect.txt

// RUN: printf 'schema_version\trun_id\tgenerated_at_utc\ttest_total\ttest_failures\ttest_xfail\ttest_xpass\ttest_skipped\tmode_total\tmode_pass\tmode_fail\tmode_xfail\tmode_xpass\tmode_epass\tmode_efail\tmode_unskip\tmode_skipped\tmode_skip_pass\tmode_skip_fail\tmode_skip_expected\tmode_skip_unexpected\tskip_reason_vhdl\tskip_reason_fail-no-macro\tskip_reason_no-property\tskip_reason_other\n' > %t/bad-history.tsv
// RUN: printf '1\told-run\tbad-time\t1\t0\t0\t0\t0\t2\t2\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\n' >> %t/bad-history.tsv
// RUN: not env CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh \
// RUN:   Z3_LIB=/dev/null EXPECT_FILE=%t/expect.txt XFAIL_FILE=/dev/null \
// RUN:   BMC_SMOKE_ONLY=1 DISABLE_UVM_AUTO_INCLUDE=1 SKIP_VHDL=0 \
// RUN:   SKIP_FAIL_WITHOUT_MACRO=0 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_TSV_FILE=%t/bad-history.tsv \
// RUN:   TEST_FILTER='.*' %S/../../utils/run_yosys_sva_circt_bmc.sh %t 2>&1 | FileCheck %s --check-prefix=BADTSV

// RUN: printf '{"schema_version":"1","run_id":"old-run","generated_at_utc":"2026-01-01T00:00:00Z","test_summary":{"total":1,"failures":0,"xfail":0,"xpass":0,"skipped":0},"skip_reasons":{"vhdl":0,"fail_no_macro":0,"no_property":0,"other":0}}\n' > %t/bad-history.jsonl
// RUN: not env CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh \
// RUN:   Z3_LIB=/dev/null EXPECT_FILE=%t/expect.txt XFAIL_FILE=/dev/null \
// RUN:   BMC_SMOKE_ONLY=1 DISABLE_UVM_AUTO_INCLUDE=1 SKIP_VHDL=0 \
// RUN:   SKIP_FAIL_WITHOUT_MACRO=0 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_JSONL_FILE=%t/bad-history.jsonl \
// RUN:   TEST_FILTER='.*' %S/../../utils/run_yosys_sva_circt_bmc.sh %t 2>&1 | FileCheck %s --check-prefix=BADJSON

// RUN: printf '{"schema_version":"1","run_id":"old-run","generated_at_utc":"2026-01-01T00:00:00Z","test_summary":{"total":"1","failures":0,"xfail":0,"xpass":0,"skipped":0},"mode_summary":{"total":2,"pass":2,"fail":0,"xfail":0,"xpass":0,"epass":0,"efail":0,"unskip":0,"skipped":0,"skip_pass":0,"skip_fail":0,"skip_expected":0,"skip_unexpected":0},"skip_reasons":{"vhdl":0,"fail_no_macro":0,"no_property":0,"other":0}}\n' > %t/bad-history-type.jsonl
// RUN: not env CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh \
// RUN:   Z3_LIB=/dev/null EXPECT_FILE=%t/expect.txt XFAIL_FILE=/dev/null \
// RUN:   BMC_SMOKE_ONLY=1 DISABLE_UVM_AUTO_INCLUDE=1 SKIP_VHDL=0 \
// RUN:   SKIP_FAIL_WITHOUT_MACRO=0 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_JSONL_FILE=%t/bad-history-type.jsonl \
// RUN:   TEST_FILTER='.*' %S/../../utils/run_yosys_sva_circt_bmc.sh %t 2>&1 | FileCheck %s --check-prefix=BADJSONTYPE

// RUN: printf 'schema_version\trun_id\tgenerated_at_utc\ttest_total\ttest_failures\ttest_xfail\ttest_xpass\ttest_skipped\tmode_total\tmode_pass\tmode_fail\tmode_xfail\tmode_xpass\tmode_epass\tmode_efail\tmode_unskip\tmode_skipped\tmode_skip_pass\tmode_skip_fail\tmode_skip_expected\tmode_skip_unexpected\tskip_reason_vhdl\tskip_reason_fail-no-macro\tskip_reason_no-property\tskip_reason_other\n' > %t/bad-history-future.tsv
// RUN: printf '1\told-run\t2099-01-01T00:00:00Z\t1\t0\t0\t0\t0\t2\t2\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\n' >> %t/bad-history-future.tsv
// RUN: not env CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh \
// RUN:   Z3_LIB=/dev/null EXPECT_FILE=%t/expect.txt XFAIL_FILE=/dev/null \
// RUN:   BMC_SMOKE_ONLY=1 DISABLE_UVM_AUTO_INCLUDE=1 SKIP_VHDL=0 \
// RUN:   SKIP_FAIL_WITHOUT_MACRO=0 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_MAX_FUTURE_SKEW_SECS=60 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_TSV_FILE=%t/bad-history-future.tsv \
// RUN:   TEST_FILTER='.*' %S/../../utils/run_yosys_sva_circt_bmc.sh %t 2>&1 | FileCheck %s --check-prefix=BADTSVFUTURE

// RUN: printf 'schema_version\trun_id\tgenerated_at_utc\ttest_total\ttest_failures\ttest_xfail\ttest_xpass\ttest_skipped\tmode_total\tmode_pass\tmode_fail\tmode_xfail\tmode_xpass\tmode_epass\tmode_efail\tmode_unskip\tmode_skipped\tmode_skip_pass\tmode_skip_fail\tmode_skip_expected\tmode_skip_unexpected\tskip_reason_vhdl\tskip_reason_fail-no-macro\tskip_reason_no-property\tskip_reason_other\n' > %t/bad-history-future.tsv
// RUN: printf '1\told-run\t2099-01-01T00:00:00Z\t1\t0\t0\t0\t0\t2\t2\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\n' >> %t/bad-history-future.tsv

// RUN: not env CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh \
// RUN:   Z3_LIB=/dev/null EXPECT_FILE=%t/expect.txt XFAIL_FILE=/dev/null \
// RUN:   BMC_SMOKE_ONLY=1 DISABLE_UVM_AUTO_INCLUDE=1 SKIP_VHDL=0 \
// RUN:   SKIP_FAIL_WITHOUT_MACRO=0 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_TSV_FILE=%t/bad-history-future.tsv \
// RUN:   TEST_FILTER='.*' %S/../../utils/run_yosys_sva_circt_bmc.sh %t 2>&1 | FileCheck %s --check-prefix=BADTSVDEFAULTFUTURE

// RUN: printf '{"schema_version":"1","run_id":"old-run","generated_at_utc":"2099-01-01T00:00:00Z","test_summary":{"total":1,"failures":0,"xfail":0,"xpass":0,"skipped":0},"mode_summary":{"total":2,"pass":2,"fail":0,"xfail":0,"xpass":0,"epass":0,"efail":0,"unskip":0,"skipped":0,"skip_pass":0,"skip_fail":0,"skip_expected":0,"skip_unexpected":0},"skip_reasons":{"vhdl":0,"fail_no_macro":0,"no_property":0,"other":0}}\n' > %t/bad-history-future.jsonl
// RUN: not env CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh \
// RUN:   Z3_LIB=/dev/null EXPECT_FILE=%t/expect.txt XFAIL_FILE=/dev/null \
// RUN:   BMC_SMOKE_ONLY=1 DISABLE_UVM_AUTO_INCLUDE=1 SKIP_VHDL=0 \
// RUN:   SKIP_FAIL_WITHOUT_MACRO=0 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_MAX_FUTURE_SKEW_SECS=60 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_JSONL_FILE=%t/bad-history-future.jsonl \
// RUN:   TEST_FILTER='.*' %S/../../utils/run_yosys_sva_circt_bmc.sh %t 2>&1 | FileCheck %s --check-prefix=BADJSONFUTURE

// RUN: printf '{"schema_version":"1","run_id":"old-run","generated_at_utc":"2026-01-01T00:00:00Z","test_summary":{"total":1,"failures":0,"xfail":0,"xpass":0,"skipped":0},"mode_summary":{"total":2,"pass":2,"fail":0,"xfail":0,"xpass":0,"epass":0,"efail":0,"unskip":0,"skipped":0,"skip_pass":0,"skip_fail":0,"skip_expected":0,"skip_unexpected":0},"skip_reasons":{"vhdl":0,"fail_no_macro":0,"no_property":0,"other":0},}\n' > %t/bad-history-syntax.jsonl
// RUN: not env CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh \
// RUN:   Z3_LIB=/dev/null EXPECT_FILE=%t/expect.txt XFAIL_FILE=/dev/null \
// RUN:   BMC_SMOKE_ONLY=1 DISABLE_UVM_AUTO_INCLUDE=1 SKIP_VHDL=0 \
// RUN:   SKIP_FAIL_WITHOUT_MACRO=0 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_JSON_VALIDATOR=python \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_JSONL_FILE=%t/bad-history-syntax.jsonl \
// RUN:   TEST_FILTER='.*' %S/../../utils/run_yosys_sva_circt_bmc.sh %t 2>&1 | FileCheck %s --check-prefix=BADJSONSYNTAX

// RUN: printf '{"schema_version":"1","run_id":"old-run","generated_at_utc":"2026-01-01T00:00:00Z","test_summary":{"total":1,"failures":0,"xfail":0,"xpass":0,"skipped":0},"mode_summary":{"total":2,"pass":2,"fail":0,"xfail":0,"xpass":0,"epass":0,"efail":0,"unskip":0,"skipped":0,"skip_pass":0,"skip_fail":0,"skip_expected":0,"skip_unexpected":0},"skip_reasons":{"vhdl":0,"fail_no_macro":0,"no_property":0,"other":0},}\n' > %t/bad-history-syntax-auto.jsonl
// RUN: not env CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh \
// RUN:   Z3_LIB=/dev/null EXPECT_FILE=%t/expect.txt XFAIL_FILE=/dev/null \
// RUN:   BMC_SMOKE_ONLY=1 DISABLE_UVM_AUTO_INCLUDE=1 SKIP_VHDL=0 \
// RUN:   SKIP_FAIL_WITHOUT_MACRO=0 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_JSONL_FILE=%t/bad-history-syntax-auto.jsonl \
// RUN:   TEST_FILTER='.*' %S/../../utils/run_yosys_sva_circt_bmc.sh %t 2>&1 | FileCheck %s --check-prefix=BADJSONSYNTAXAUTO

// RUN: not env CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh \
// RUN:   Z3_LIB=/dev/null EXPECT_FILE=%t/expect.txt XFAIL_FILE=/dev/null \
// RUN:   BMC_SMOKE_ONLY=1 DISABLE_UVM_AUTO_INCLUDE=1 SKIP_VHDL=0 \
// RUN:   SKIP_FAIL_WITHOUT_MACRO=0 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_JSON_VALIDATOR=bogus \
// RUN:   TEST_FILTER='.*' %S/../../utils/run_yosys_sva_circt_bmc.sh %t 2>&1 | FileCheck %s --check-prefix=BADVALIDATOR

// RUN: printf '{"schema_version":"1","run_id":"old-run","generated_at_utc":"2026-01-01T00:00:00Z","test_summary":{"total":1,"failures":0,"xfail":0,"xpass":0,"skipped":0},"mode_summary":{"total":2,"pass":2,"fail":0,"xfail":0,"xpass":0,"epass":0,"efail":0,"unskip":0,"skipped":0,"skip_pass":0,"skip_fail":0,"skip_expected":0,"skip_unexpected":0},"skip_reasons":{"vhdl":0,"vhdl":1,"fail_no_macro":0,"no_property":0,"other":0}}\n' > %t/bad-history-duplicate.jsonl
// RUN: not env CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh \
// RUN:   Z3_LIB=/dev/null EXPECT_FILE=%t/expect.txt XFAIL_FILE=/dev/null \
// RUN:   BMC_SMOKE_ONLY=1 DISABLE_UVM_AUTO_INCLUDE=1 SKIP_VHDL=0 \
// RUN:   SKIP_FAIL_WITHOUT_MACRO=0 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_JSON_VALIDATOR=python \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_JSONL_FILE=%t/bad-history-duplicate.jsonl \
// RUN:   TEST_FILTER='.*' %S/../../utils/run_yosys_sva_circt_bmc.sh %t 2>&1 | FileCheck %s --check-prefix=BADJSONDUPLICATE

// RUN: printf '{"schema_version":"1","run_id":"old-run","generated_at_utc":"2026-01-01T00:00:00Z","test_summary":{"total":1,"failures":0,"xfail":0,"xpass":0,"skipped":0},"mode_summary":{"total":2,"pass":2,"fail":0,"xfail":0,"xpass":0,"epass":0,"efail":0,"unskip":0,"skipped":0,"skip_pass":0,"skip_fail":0,"skip_expected":0,"skip_unexpected":0},"skip_reasons":{"vhdl":0,"fail_no_macro":0,"no_property":0,"other":0},"drop_events_summary":{"total":0,"reasons":{"future_skew":0,"age_retention":0,"max_entries":0},"history_format":{"tsv":0,"jsonl":0},"id_hash_mode":7}}\n' > %t/bad-history-idhash.jsonl
// RUN: not env CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh \
// RUN:   Z3_LIB=/dev/null EXPECT_FILE=%t/expect.txt XFAIL_FILE=/dev/null \
// RUN:   BMC_SMOKE_ONLY=1 DISABLE_UVM_AUTO_INCLUDE=1 SKIP_VHDL=0 \
// RUN:   SKIP_FAIL_WITHOUT_MACRO=0 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_JSON_VALIDATOR=python \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_JSONL_FILE=%t/bad-history-idhash.jsonl \
// RUN:   TEST_FILTER='.*' %S/../../utils/run_yosys_sva_circt_bmc.sh %t 2>&1 | FileCheck %s --check-prefix=BADJSONIDHASH

// RUN: printf '{"schema_version":"1","run_id":"old-run","generated_at_utc":"2026-01-01T00:00:00Z","test_summary":{"total":1,"failures":0,"xfail":0,"xpass":0,"skipped":0},"mode_summary":{"total":2,"pass":2,"fail":0,"xfail":0,"xpass":0,"epass":0,"efail":0,"unskip":0,"skipped":0,"skip_pass":0,"skip_fail":0,"skip_expected":0,"skip_unexpected":0},"skip_reasons":{"vhdl":0,"fail_no_macro":0,"no_property":0,"other":0},"drop_events_summary":{"total":0,"reasons":{"future_skew":0,"age_retention":0,"max_entries":0},"history_format":{"tsv":0,"jsonl":0},"id_hash_mode":"crc32","id_hash_algorithm":"sha256","id_hash_version":1}}\n' > %t/bad-history-idalgo.jsonl
// RUN: not env CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh \
// RUN:   Z3_LIB=/dev/null EXPECT_FILE=%t/expect.txt XFAIL_FILE=/dev/null \
// RUN:   BMC_SMOKE_ONLY=1 DISABLE_UVM_AUTO_INCLUDE=1 SKIP_VHDL=0 \
// RUN:   SKIP_FAIL_WITHOUT_MACRO=0 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_JSON_VALIDATOR=python \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_JSONL_FILE=%t/bad-history-idalgo.jsonl \
// RUN:   TEST_FILTER='.*' %S/../../utils/run_yosys_sva_circt_bmc.sh %t 2>&1 | FileCheck %s --check-prefix=BADJSONIDALGO

// BADTSV: error: invalid generated_at_utc
// BADJSON: error: missing key 'mode_summary' in YOSYS_SVA_MODE_SUMMARY_HISTORY_JSONL_FILE
// BADJSONTYPE: error: invalid numeric summary field 'test_summary.total'
// BADTSVFUTURE: error: generated_at_utc exceeds YOSYS_SVA_MODE_SUMMARY_HISTORY_MAX_FUTURE_SKEW_SECS
// BADTSVDEFAULTFUTURE: error: generated_at_utc exceeds YOSYS_SVA_MODE_SUMMARY_HISTORY_MAX_FUTURE_SKEW_SECS
// BADJSONFUTURE: error: generated_at_utc exceeds YOSYS_SVA_MODE_SUMMARY_HISTORY_MAX_FUTURE_SKEW_SECS
// BADJSONSYNTAX: error: invalid JSON object in YOSYS_SVA_MODE_SUMMARY_HISTORY_JSONL_FILE
// BADJSONSYNTAXAUTO: error: invalid JSON object in YOSYS_SVA_MODE_SUMMARY_HISTORY_JSONL_FILE
// BADVALIDATOR: invalid YOSYS_SVA_MODE_SUMMARY_HISTORY_JSON_VALIDATOR: bogus (expected auto|python)
// BADJSONDUPLICATE: error: duplicate key in YOSYS_SVA_MODE_SUMMARY_HISTORY_JSONL_FILE
// BADJSONIDHASH: error: invalid summary field 'drop_events_summary.id_hash_mode' in YOSYS_SVA_MODE_SUMMARY_HISTORY_JSONL_FILE
// BADJSONIDALGO: error: invalid summary field 'drop_events_summary.id_hash_algorithm' in YOSYS_SVA_MODE_SUMMARY_HISTORY_JSONL_FILE
