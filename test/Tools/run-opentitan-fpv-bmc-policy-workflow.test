// RUN: rm -rf %t
// RUN: mkdir -p %t/utils %t/utils/opentitan_fpv_policy
// RUN: cp %S/../../utils/run_opentitan_fpv_bmc_policy_workflow.sh %t/utils/run_opentitan_fpv_bmc_policy_workflow.sh
// RUN: cp %S/../../utils/opentitan_fpv_policy/task_profile_status_presets.tsv %t/utils/opentitan_fpv_policy/task_profile_status_presets.tsv
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\n: \"${ARG_LOG:?}\"\n: > \"$ARG_LOG\"\nfor arg in \"$@\"; do\n  echo \"$arg\" >> \"$ARG_LOG\"\ndone\n' > %t/utils/fake-run-formal-all.sh
// RUN: chmod +x %t/utils/run_opentitan_fpv_bmc_policy_workflow.sh %t/utils/fake-run-formal-all.sh
// RUN: ARG_LOG=%t/update.args %t/utils/run_opentitan_fpv_bmc_policy_workflow.sh --run-formal-all %t/utils/fake-run-formal-all.sh update --out-dir %t/out-update --opentitan-fpv-cfg %t/cfg.hjson --select-cfgs foo_fpv
// RUN: FileCheck %s --check-prefix=UPDATE < %t/update.args
// RUN: ARG_LOG=%t/check.args %t/utils/run_opentitan_fpv_bmc_policy_workflow.sh --run-formal-all %t/utils/fake-run-formal-all.sh check --out-dir %t/out-check --opentitan-fpv-cfg %t/cfg.hjson --select-cfgs foo_fpv
// RUN: FileCheck %s --check-prefix=CHECK < %t/check.args
// RUN: ARG_LOG=%t/check-nostrict.args %t/utils/run_opentitan_fpv_bmc_policy_workflow.sh --run-formal-all %t/utils/fake-run-formal-all.sh --no-strict-gate check --out-dir %t/out-check-nostrict --opentitan-fpv-cfg %t/cfg.hjson --select-cfgs foo_fpv
// RUN: FileCheck %s --check-prefix=CHECK-NOSTRICT < %t/check-nostrict.args
// RUN: not rg -q -- '--strict-gate' %t/check-nostrict.args
// RUN: not sh -c '%t/utils/run_opentitan_fpv_bmc_policy_workflow.sh --run-formal-all %t/utils/fake-run-formal-all.sh update --out-dir %t/out-invalid --opentitan-fpv-cfg %t/cfg.hjson --select-cfgs foo_fpv --opentitan-fpv-bmc-summary-baseline-file %t/bad.tsv > %t/err.txt 2>&1'
// RUN: FileCheck %s --check-prefix=ERR < %t/err.txt
//
// UPDATE-DAG: --out-dir
// UPDATE-DAG: {{.*/}}out-update
// UPDATE-DAG: --opentitan-fpv-cfg
// UPDATE-DAG: {{.*/}}cfg.hjson
// UPDATE-DAG: --select-cfgs
// UPDATE-DAG: foo_fpv
// UPDATE-DAG: --with-opentitan-fpv-bmc
// UPDATE-DAG: --opentitan-fpv-bmc-assertion-status-policy-task-profile-presets-file
// UPDATE-DAG: {{.*/}}utils/opentitan_fpv_policy/task_profile_status_presets.tsv
// UPDATE-DAG: --opentitan-fpv-bmc-summary-baseline-file
// UPDATE-DAG: {{.*/}}utils/opentitan_fpv_policy/baselines/opentitan-fpv-bmc-fpv-summary-baseline.tsv
// UPDATE-DAG: --opentitan-fpv-bmc-assertion-results-baseline-file
// UPDATE-DAG: {{.*/}}utils/opentitan_fpv_policy/baselines/opentitan-fpv-bmc-assertion-results-baseline.tsv
// UPDATE-DAG: --opentitan-fpv-bmc-assertion-status-policy-grouped-violations-baseline-file
// UPDATE-DAG: {{.*/}}utils/opentitan_fpv_policy/baselines/opentitan-fpv-bmc-assertion-status-policy-grouped-violations-baseline.tsv
// UPDATE-DAG: --update-opentitan-fpv-bmc-summary-baseline
// UPDATE-DAG: --update-opentitan-fpv-bmc-assertion-results-baseline
// UPDATE-DAG: --update-opentitan-fpv-bmc-assertion-status-policy-grouped-violations-baseline
//
// CHECK-DAG: --fail-on-opentitan-fpv-bmc-summary-drift
// CHECK-DAG: --fail-on-opentitan-fpv-bmc-assertion-results-drift
// CHECK-DAG: --fail-on-opentitan-fpv-bmc-assertion-status-policy
// CHECK-DAG: --fail-on-opentitan-fpv-bmc-assertion-status-policy-grouped-violations-drift
// CHECK-DAG: --strict-gate
//
// CHECK-NOSTRICT-DAG: --fail-on-opentitan-fpv-bmc-summary-drift
// CHECK-NOSTRICT-DAG: --fail-on-opentitan-fpv-bmc-assertion-results-drift
// CHECK-NOSTRICT-DAG: --fail-on-opentitan-fpv-bmc-assertion-status-policy
// CHECK-NOSTRICT-DAG: --fail-on-opentitan-fpv-bmc-assertion-status-policy-grouped-violations-drift
//
// ERR: workflow-managed option must not be passed explicitly: --opentitan-fpv-bmc-summary-baseline-file
