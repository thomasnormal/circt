// RUN: rm -rf %t && mkdir -p %t
// RUN: printf 'module top(input a, output y); assign y = a; endmodule\n' > %t/design.v
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nscript="${@: -1}"\nwhile IFS= read -r line; do\n  out=$(sed -n "s/.*-o \\\"\\([^\\\"]*\\)\\\".*/\\1/p" <<< "$line")\n  mode=$(sed -n "s/.*-mode \\([^ ]*\\).*/\\1/p" <<< "$line")\n  if [[ "$mode" == "inv" || "$mode" == "const0" || "$mode" == "const1" ]]; then\n    grep -q -- "-cfg weight_pq_w 5" <<< "$line"\n    grep -q -- "-cfg weight_pq_mw 5" <<< "$line"\n    echo "100 M_ARITH_PROFILE" > "$out"\n  elif [[ "$mode" == "cnot0" || "$mode" == "cnot1" ]]; then\n    grep -q -- "-cfg weight_pq_c 5" <<< "$line"\n    grep -q -- "-cfg weight_pq_mc 5" <<< "$line"\n    echo "200 M_CTRL_PROFILE" > "$out"\n  else\n    exit 3\n  fi\ndone < <(grep "^mutate -list " "$script")\n' > %t/fake-yosys.sh
// RUN: chmod +x %t/fake-yosys.sh

// RUN: %S/../../utils/generate_mutations_yosys.sh --design %t/design.v --out %t/mutations.txt --count 2 --seed 7 --profiles arith-depth,control-depth --yosys %t/fake-yosys.sh
// RUN: FileCheck %s --check-prefix=OUT < %t/mutations.txt

// OUT: 1 M_ARITH_PROFILE
// OUT: 2 M_CTRL_PROFILE
