// RUN: rm -rf %t
// RUN: mkdir -p %t/utils %t/bin %t/src
// RUN: cp %S/../../utils/run_pairwise_circt_bmc.py %t/utils/run_pairwise_circt_bmc.py
// RUN: touch %t/src/a.sv
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nout=\"\"\nargs=\"$*\"\nwhile [[ $# -gt 0 ]]; do\n  case \"$1\" in\n    -o) out=\"$2\"; shift 2 ;;\n    *) shift ;;\n  esac\ndone\nif [[ \"$args\" == *\"top_error\"* ]]; then\n  echo \"parse exploded\" >&2\n  exit 1\nfi\n: \"${out:?}\"\n: > \"$out\"\nexit 0\n' > %t/bin/circt-verilog
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\necho \"BMC_RESULT=UNSAT\"\nexit 0\n' > %t/bin/circt-bmc
// RUN: chmod +x %t/utils/run_pairwise_circt_bmc.py %t/bin/circt-verilog %t/bin/circt-bmc
// RUN: printf 'error_case\ttop_error\t%t/src/a.sv\t%t/src\t%t/work/error\n' > %t/cases.tsv
// RUN: not sh -c 'env CIRCT_VERILOG=%t/bin/circt-verilog CIRCT_BMC=%t/bin/circt-bmc BMC_RUN_SMTLIB=0 BMC_PREPARE_CORE_WITH_CIRCT_OPT=0 OUT=%t/results.tsv python3 %t/utils/run_pairwise_circt_bmc.py --cases-file %t/cases.tsv --workdir %t/work --results-jsonl-file %t/results.jsonl'
// RUN: python3 -c "import json; rows=[json.loads(line) for line in open('%t/results.jsonl', encoding='utf-8') if line.strip()]; assert len(rows)==1; row=rows[0]; assert row['case_id']=='error_case'; assert row['status']=='ERROR'; assert row['reason_code']=='PARSE_EXPLODED'; assert row['stage']=='frontend'; assert row['log_path'].endswith('/work/error_case/circt-verilog.log'); assert row['artifact_dir'].endswith('/work/error_case')"
