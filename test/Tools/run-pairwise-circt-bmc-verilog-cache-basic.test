// RUN: rm -rf %t
// RUN: mkdir -p %t/bin %t/src %t/cache %t/work1 %t/work2
// RUN: printf 'module top_pass(input logic clk); endmodule\n' > %t/src/a.sv
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nout=\"\"\nfor ((i=1; i<=$#; ++i)); do\n  arg=\"${!i}\"\n  if [[ \"$arg\" == \"-o\" ]]; then\n    j=$((i+1))\n    out=\"${!j}\"\n  fi\ndone\n: \"${out:?}\"\nif [[ \"${CIRCT_VERILOG_FORCE_FAIL:-0}\" == \"1\" ]]; then\n  echo \"forced frontend failure\" >&2\n  exit 1\nfi\n: > \"$out\"\nexit 0\n' > %t/bin/circt-verilog
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\necho \"BMC_RESULT=UNSAT\"\n' > %t/bin/circt-bmc
// RUN: chmod +x %t/bin/circt-verilog %t/bin/circt-bmc
// RUN: printf 'cache_case\ttop_pass\t%t/src/a.sv\t%t/src\t%t/work/cache_case\n' > %t/cases.tsv
// RUN: env CIRCT_VERILOG=%t/bin/circt-verilog CIRCT_BMC=%t/bin/circt-bmc BMC_RUN_SMTLIB=0 BMC_PREPARE_CORE_WITH_CIRCT_OPT=0 BMC_VERILOG_SINGLE_UNIT_MODE=off BMC_VERILOG_CACHE_MODE=readwrite BMC_VERILOG_CACHE_DIR=%t/cache OUT=%t/results1.tsv BMC_LAUNCH_EVENTS_OUT=%t/launch1.tsv %S/../../utils/run_pairwise_circt_bmc.py --cases-file %t/cases.tsv --workdir %t/work1
// RUN: env CIRCT_VERILOG=%t/bin/circt-verilog CIRCT_BMC=%t/bin/circt-bmc CIRCT_VERILOG_FORCE_FAIL=1 BMC_RUN_SMTLIB=0 BMC_PREPARE_CORE_WITH_CIRCT_OPT=0 BMC_VERILOG_SINGLE_UNIT_MODE=off BMC_VERILOG_CACHE_MODE=read BMC_VERILOG_CACHE_DIR=%t/cache OUT=%t/results2.tsv BMC_LAUNCH_EVENTS_OUT=%t/launch2.tsv %S/../../utils/run_pairwise_circt_bmc.py --cases-file %t/cases.tsv --workdir %t/work2
// RUN: FileCheck %s --check-prefix=RES2 < %t/results2.tsv
// RUN: FileCheck %s --check-prefix=LAUNCH2 < %t/launch2.tsv
//
// RES2: PASS{{[[:space:]]+}}cache_case{{[[:space:]]+}}{{.*}}work/cache_case{{[[:space:]]+}}pairwise{{[[:space:]]+}}BMC{{[[:space:]]+}}UNSAT
// LAUNCH2: CACHE{{[[:space:]]+}}cache_case{{[[:space:]]+}}{{.*}}work/cache_case{{[[:space:]]+}}verilog{{[[:space:]]+}}{{.*}}circt-verilog{{[[:space:]]+}}verilog_cache_hit{{[[:space:]]+}}0
