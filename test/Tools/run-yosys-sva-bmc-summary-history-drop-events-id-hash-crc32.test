// RUN: rm -rf %t && mkdir -p %t
// RUN: echo 'module top(input logic clk); logic a; assign a = 1'\''b1; assert property (@(posedge clk) a); endmodule' > %t/simple.sv
// RUN: echo '#!/usr/bin/env bash' > %t/fake-verilog.sh && echo 'echo "// dummy mlir"' >> %t/fake-verilog.sh
// RUN: echo '#!/usr/bin/env bash' > %t/fake-bmc.sh && echo 'exit 0' >> %t/fake-bmc.sh
// RUN: chmod +x %t/fake-verilog.sh %t/fake-bmc.sh
// RUN: printf 'simple\t*\t*\tpass\n' > %t/expect.txt
//
// RUN: printf '{"schema_version":"1","run_id":"run-old","generated_at_utc":"2025-01-01T00:00:00Z","test_summary":{"total":1,"failures":0,"xfail":0,"xpass":0,"skipped":0},"mode_summary":{"total":2,"pass":2,"fail":0,"xfail":0,"xpass":0,"epass":0,"efail":0,"unskip":0,"skipped":0,"skip_pass":0,"skip_fail":0,"skip_expected":0,"skip_unexpected":0},"skip_reasons":{"vhdl":0,"fail_no_macro":0,"no_property":0,"other":0}}\n' > %t/history.jsonl
// RUN: printf '{"schema_version":"1","run_id":"run-keep","generated_at_utc":"2025-01-02T00:00:00Z","test_summary":{"total":1,"failures":0,"xfail":0,"xpass":0,"skipped":0},"mode_summary":{"total":2,"pass":2,"fail":0,"xfail":0,"xpass":0,"epass":0,"efail":0,"unskip":0,"skipped":0,"skip_pass":0,"skip_fail":0,"skip_expected":0,"skip_unexpected":0},"skip_reasons":{"vhdl":0,"fail_no_macro":0,"no_property":0,"other":0}}\n' >> %t/history.jsonl
//
// RUN: env CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh \
// RUN:   Z3_LIB=/dev/null EXPECT_FILE=%t/expect.txt XFAIL_FILE=/dev/null \
// RUN:   BMC_SMOKE_ONLY=1 DISABLE_UVM_AUTO_INCLUDE=1 SKIP_VHDL=0 \
// RUN:   SKIP_FAIL_WITHOUT_MACRO=0 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_RUN_ID=run-new \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_JSONL_FILE=%t/history.jsonl \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_MAX_ENTRIES=1 \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_DROP_EVENTS_JSONL_FILE=%t/drop-events.jsonl \
// RUN:   YOSYS_SVA_MODE_SUMMARY_HISTORY_DROP_EVENTS_ID_HASH=crc32 \
// RUN:   %S/../../utils/run_yosys_sva_circt_bmc.sh %t > %t/run.out
//
// RUN: cat %t/drop-events.jsonl | FileCheck %s --check-prefix=DROP
//
// DROP: {"schema_version":"1","event_id":"drop-2493518441","generated_at_utc":"{{[0-9T:\-]+Z}}","reason":"max_entries","history_file":"{{.*history\.jsonl}}","history_format":"jsonl","line":1,"row_generated_at_utc":"2025-01-01T00:00:00Z","run_id":"run-old"}
