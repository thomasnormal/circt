// RUN: rm -rf %t && mkdir -p %t
// RUN: printf 'module top(input a, output y); assign y = a; endmodule\n' > %t/design.v
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\necho hit >> "$HITS"\nscript="${@: -1}"\nout=$(sed -n "s/.*-o \\\"\\([^\\\"]*\\)\\\".*/\\1/p" "$script" | tail -n1)\necho "1 MUT_CACHE_A" > "$out"\necho "2 MUT_CACHE_B" >> "$out"\n' > %t/fake-yosys.sh
// RUN: chmod +x %t/fake-yosys.sh
// RUN: env HITS=%t/hits.txt circt-mut generate --design %t/design.v --out %t/mutations-a.txt --top top --count 2 --seed 7 --yosys %t/fake-yosys.sh --cache-dir %t/cache > %t/miss.out
// RUN: env HITS=%t/hits.txt circt-mut generate --design %t/design.v --out %t/mutations-b.txt --top top --count 2 --seed 7 --yosys %t/fake-yosys.sh --cache-dir %t/cache > %t/hit.out
// RUN: diff -u %t/mutations-a.txt %t/mutations-b.txt
// RUN: wc -l < %t/hits.txt | FileCheck %s --check-prefix=HITS
// RUN: ls %t/cache/*.mutations.txt | wc -l | FileCheck %s --check-prefix=CACHE
// RUN: FileCheck %s --check-prefix=MISS < %t/miss.out
// RUN: FileCheck %s --check-prefix=HIT < %t/hit.out

// HITS: 1
// CACHE: 1
// MISS: Mutation generation runtime_ns: {{[0-9]+}}
// MISS: Mutation cache saved_runtime_ns: 0
// MISS: Mutation cache lock_wait_ns: {{[0-9]+}}
// MISS: Mutation cache lock_contended: 0
// MISS: Mutation cache status: miss
// MISS: Mutation cache file:
// HIT: Mutation generation runtime_ns: {{[0-9]+}}
// HIT: Mutation cache saved_runtime_ns: {{[0-9]+}}
// HIT: Mutation cache lock_wait_ns: {{[0-9]+}}
// HIT: Mutation cache lock_contended: 0
// HIT: Mutation cache status: hit
// HIT: Mutation cache file:
