// RUN: rm -rf %t && mkdir -p %t/proj %t/scripts %t/formal-out
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nout_dir=\"\"\nwhile [[ $# -gt 0 ]]; do\n  case \"$1\" in\n    --out-dir) out_dir=\"$2\"; shift 2 ;;\n    --out-dir=*) out_dir=\"${1#*=}\"; shift ;;\n    *) shift ;;\n  esac\ndone\nmkdir -p \"$out_dir/lane1\"\nprintf \"total_mutants\\t6\\nrelevant_mutants\\t6\\ndetected_mutants\\t2\\npropagated_not_detected_mutants\\t2\\nnot_propagated_mutants\\t1\\nnot_activated_mutants\\t1\\nerrors\\t0\\nglobal_filter_timeout_mutants\\t0\\nglobal_filter_lec_unknown_mutants\\t0\\nglobal_filter_bmc_unknown_mutants\\t0\\n\" > \"$out_dir/lane1/metrics.tsv\"\nprintf \"lane_id\\tstatus\\texit_code\\tcoverage_percent\\truntime_ns\\tgate_status\\tlane_dir\\tmetrics_file\\tsummary_json\\tprequalify_summary_present\\tprequalify_pair_file\\tprequalify_log_file\\tprequalify_total_mutants\\tprequalify_not_propagated_mutants\\tprequalify_propagated_mutants\\tprequalify_create_mutated_error_mutants\\tprequalify_probe_error_mutants\\tprequalify_cmd_token_not_propagated_mutants\\tprequalify_cmd_token_propagated_mutants\\tprequalify_cmd_rc_not_propagated_mutants\\tprequalify_cmd_rc_propagated_mutants\\tprequalify_cmd_timeout_propagated_mutants\\tprequalify_cmd_error_mutants\\n\" > \"$out_dir/results.tsv\"\nprintf \"lane1\\tPASS\\t0\\t33.33\\t1000\\tPASS\\t$out_dir/lane1\\t$out_dir/lane1/metrics.tsv\\t-\\t1\\t$out_dir/prequalify_pair.tsv\\t$out_dir/prequalify.log\\t6\\t2\\t4\\t0\\t0\\t0\\t0\\t0\\t0\\t0\\t0\\n\" >> \"$out_dir/results.tsv\"\nprintf \"lane_id\\tpair_file\\tlog_file\\thas_summary\\tprequalify_total_mutants\\tprequalify_not_propagated_mutants\\tprequalify_propagated_mutants\\tprequalify_create_mutated_error_mutants\\tprequalify_probe_error_mutants\\tprequalify_cmd_token_not_propagated_mutants\\tprequalify_cmd_token_propagated_mutants\\tprequalify_cmd_rc_not_propagated_mutants\\tprequalify_cmd_rc_propagated_mutants\\tprequalify_cmd_timeout_propagated_mutants\\tprequalify_cmd_error_mutants\\n\" > \"$out_dir/native_matrix_prequalify_summary.tsv\"\nprintf \"lane1\\t$out_dir/prequalify_pair.tsv\\t$out_dir/prequalify.log\\t1\\t6\\t2\\t4\\t0\\t0\\t0\\t0\\t0\\t0\\t0\\t0\\n\" >> \"$out_dir/native_matrix_prequalify_summary.tsv\"\n' > %t/scripts/run_mutation_matrix.sh
// RUN: chmod +x %t/scripts/run_mutation_matrix.sh
// RUN: printf 'lane1\tdesign.il\tmutations.txt\ttests.tsv\t-\t-\t-\n' > %t/proj/lanes.tsv
// RUN: printf '[run]\nwith_report = true\nreport_mode = "matrix"\n[matrix]\nlanes_tsv = "lanes.tsv"\nout_dir = "out/matrix"\n' > %t/proj/circt-mut.toml
// RUN: printf 'suite\tmode\ttotal\tpass\tfail\txfail\txpass\terror\tskip\tsummary\nsv-tests\tBMC\t1\t1\t0\t0\t0\t0\t0\ttotal=1 pass=1 fail=0 xfail=0 xpass=0 error=0 skip=0 bmc_timeout_stage_frontend_cases=0 bmc_timeout_stage_solver_cases=0 bmc_timeout_stage_unknown_cases=0\nsv-tests-uvm\tBMC_SEMANTICS\t1\t1\t0\t0\t0\t0\t0\ttotal=1 pass=1 fail=0 xfail=0 xpass=0 error=0 skip=0 bmc_timeout_stage_frontend_cases=0 bmc_timeout_stage_solver_cases=0 bmc_timeout_stage_unknown_cases=0\nverilator-verification\tBMC\t1\t1\t0\t0\t0\t0\t0\ttotal=1 pass=1 fail=0 xfail=0 xpass=0 error=0 skip=0 bmc_timeout_stage_frontend_cases=0 bmc_timeout_stage_solver_cases=0 bmc_timeout_stage_unknown_cases=0\nyosys/tests/sva\tBMC\t1\t1\t0\t0\t0\t0\t0\ttotal=1 pass=1 fail=0 xfail=0 xpass=0 error=0 skip=0 bmc_timeout_stage_frontend_cases=0 bmc_timeout_stage_solver_cases=0 bmc_timeout_stage_unknown_cases=0\nsv-tests\tLEC\t1\t1\t0\t0\t0\t0\t0\ttotal=1 pass=1 fail=0 xfail=0 xpass=0 error=0 skip=0 lec_timeout_stage_frontend_cases=0 lec_timeout_stage_solver_cases=0 lec_timeout_stage_unknown_cases=0\nverilator-verification\tLEC\t1\t1\t0\t0\t0\t0\t0\ttotal=1 pass=1 fail=0 xfail=0 xpass=0 error=0 skip=0 lec_timeout_stage_frontend_cases=0 lec_timeout_stage_solver_cases=0 lec_timeout_stage_unknown_cases=0 lec_error_bucket_semantic_diag_parser_cases=0 lec_error_bucket_semantic_diag_lowering_cases=0 lec_error_bucket_semantic_diag_solver_cases=0\nyosys/tests/sva\tLEC\t1\t1\t0\t0\t0\t0\t0\ttotal=1 pass=1 fail=0 xfail=0 xpass=0 error=0 skip=0 lec_timeout_stage_frontend_cases=0 lec_timeout_stage_solver_cases=0 lec_timeout_stage_unknown_cases=0 lec_error_bucket_semantic_diag_parser_cases=0 lec_error_bucket_semantic_diag_lowering_cases=0 lec_error_bucket_semantic_diag_solver_cases=0\n' > %t/formal-out/summary.tsv
// RUN: env CIRCT_MUT_SCRIPTS_DIR=%t/scripts circt-mut run --project-dir %t/proj --mode matrix --report-policy-mode native-strict-formal-quality-strict --report-external-formal-out-dir %t/formal-out > %t/out.txt
// RUN: FileCheck %s < %t/out.txt
//
// CHECK: policy.mode{{[[:space:]]}}native-strict-formal-quality-strict
// CHECK: policy.mode_is_native_strict{{[[:space:]]}}1
// CHECK: policy.profile_count{{[[:space:]]}}7
// CHECK: policy.profile_1{{[[:space:]]}}formal-regression-matrix-composite-native-strict
// CHECK: policy.profile_2{{[[:space:]]}}formal-regression-matrix-external-formal-core-timeout-stage-budget-strict-v1
// CHECK: policy.profile_3{{[[:space:]]}}formal-regression-matrix-external-formal-semantic-diag-family-guard
// CHECK: policy.profile_4{{[[:space:]]}}formal-regression-matrix-external-formal-bmc-semantic-family-guard
// CHECK: policy.profile_5{{[[:space:]]}}formal-regression-matrix-external-formal-bmc-core-min-total-v1
// CHECK: policy.profile_6{{[[:space:]]}}formal-regression-matrix-external-formal-lec-core-min-total-v1
// CHECK: policy.profile_7{{[[:space:]]}}formal-regression-matrix-policy-mode-native-strict-contract
// CHECK: value_gate.status{{[[:space:]]}}pass
