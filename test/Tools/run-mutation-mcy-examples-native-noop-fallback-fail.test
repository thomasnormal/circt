// RUN: rm -rf %t && mkdir -p %t/examples/bitcnt %t/bin
// RUN: printf 'module bitcnt; endmodule\n' > %t/examples/bitcnt/bitcnt.v
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nsubcmd="$1"\nshift\nif [[ "$subcmd" != "cover" ]]; then\n  echo "expected cover subcommand" >&2\n  exit 9\nfi\nwork_dir=""\ndesign=""\nmutations_file=""\ncreate_mutated=""\nwhile [[ $# -gt 0 ]]; do\n  case "$1" in\n    --work-dir) work_dir="$2"; shift 2 ;;\n    --work-dir=*) work_dir="${1#*=}"; shift ;;\n    --design) design="$2"; shift 2 ;;\n    --design=*) design="${1#*=}"; shift ;;\n    --mutations-file) mutations_file="$2"; shift 2 ;;\n    --mutations-file=*) mutations_file="${1#*=}"; shift ;;\n    --create-mutated-script) create_mutated="$2"; shift 2 ;;\n    --create-mutated-script=*) create_mutated="${1#*=}"; shift ;;\n    *) shift ;;\n  esac\ndone\nmkdir -p "$work_dir"\nread -r mid label < "$mutations_file"\necho "$mid $label" > "$work_dir/mut.input"\n"$create_mutated" -i "$work_dir/mut.input" -o "$work_dir/mutant.v" -d "$design"\nprintf "detected_mutants\\t1\\nrelevant_mutants\\t1\\nerrors\\t0\\n" > "$work_dir/metrics.tsv"\n' > %t/bin/circt-mut
// RUN: chmod +x %t/bin/circt-mut

// RUN: not %S/../../utils/run_mutation_mcy_examples.sh \
// RUN:   --examples-root %t/examples \
// RUN:   --example bitcnt \
// RUN:   --circt-mut %t/bin/circt-mut \
// RUN:   --mutations-backend native \
// RUN:   --fail-on-native-noop-fallback \
// RUN:   --out-dir %t/out

// RUN: FileCheck %s --check-prefix=SUMMARY < %t/out/summary.tsv

// SUMMARY: bitcnt{{[[:space:]]}}FAIL{{[[:space:]]}}0{{[[:space:]]}}1{{[[:space:]]}}1{{[[:space:]]}}100.00{{[[:space:]]}}0
