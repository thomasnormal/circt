// RUN: circt-verilog-lsp-server -lit-test < %s | FileCheck %s
// REQUIRES: slang
// UNSUPPORTED: valgrind
// Test rename edge cases: invalid names, keywords, non-renameable symbols.
{"jsonrpc":"2.0","id":0,"method":"initialize","params":{"processId":123,"rootPath":"verilog","capabilities":{},"trace":"off"}}
// -----
{"jsonrpc":"2.0","method":"textDocument/didOpen","params":{"textDocument":{
  "uri":"test:///rename_edge.sv",
  "languageId":"verilog",
  "version":1,
  "text":"module test;\n  logic signal_a;\n  logic signal_b;\n  initial begin\n    signal_a = 1'b0;\n    signal_b = signal_a;\n  end\nendmodule"
}}}
// -----
// Test rename with invalid identifier (starts with number)
{"jsonrpc":"2.0","id":1,"method":"textDocument/rename","params":{
  "textDocument":{"uri":"test:///rename_edge.sv"},
  "position":{"line":1,"character":8},
  "newName":"123invalid"
}}
// CHECK:       "error":
// CHECK:         "message": "cannot rename symbol at this position"
// CHECK:       "id": 1
// -----
// Test rename with empty name
{"jsonrpc":"2.0","id":2,"method":"textDocument/rename","params":{
  "textDocument":{"uri":"test:///rename_edge.sv"},
  "position":{"line":1,"character":8},
  "newName":""
}}
// CHECK:       "error":
// CHECK:         "message": "cannot rename symbol at this position"
// CHECK:       "id": 2
// -----
// Test valid rename with underscore
{"jsonrpc":"2.0","id":3,"method":"textDocument/rename","params":{
  "textDocument":{"uri":"test:///rename_edge.sv"},
  "position":{"line":1,"character":8},
  "newName":"_valid_name"
}}
// CHECK:       "id": 3,
// CHECK-NEXT:  "jsonrpc": "2.0",
// CHECK-NEXT:  "result": {
// CHECK:         "changes": {
// CHECK:           "test:///rename_edge.sv": [
// CHECK:             "newText": "_valid_name"
// -----
// Test valid rename with dollar sign (allowed in SystemVerilog)
{"jsonrpc":"2.0","id":4,"method":"textDocument/rename","params":{
  "textDocument":{"uri":"test:///rename_edge.sv"},
  "position":{"line":2,"character":8},
  "newName":"signal$b"
}}
// CHECK:       "id": 4,
// CHECK-NEXT:  "jsonrpc": "2.0",
// CHECK-NEXT:  "result": {
// CHECK:         "changes": {
// CHECK:           "test:///rename_edge.sv": [
// CHECK:             "newText": "signal$b"
// -----
{"jsonrpc":"2.0","id":99,"method":"shutdown"}
// -----
{"jsonrpc":"2.0","method":"exit"}
