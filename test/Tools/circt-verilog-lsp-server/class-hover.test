// RUN: circt-verilog-lsp-server -lit-test < %s | FileCheck %s
// REQUIRES: slang
// UNSUPPORTED: valgrind
// Test hover functionality for SystemVerilog classes (important for UVM support).
// Note: Classes must be inside a package or module to be properly indexed.
{"jsonrpc":"2.0","id":0,"method":"initialize","params":{"processId":123,"rootPath":"verilog","capabilities":{},"trace":"off"}}
// -----
{"jsonrpc":"2.0","method":"textDocument/didOpen","params":{"textDocument":{
  "uri":"test:///classes.sv",
  "languageId":"systemverilog",
  "version":1,
  "text":"package test_pkg;\n  class BaseTransaction;\n    rand bit [7:0] data;\n    int id;\n    function void display();\n      $display(\"id=%d data=%h\", id, data);\n    endfunction\n  endclass\n\n  class MyTransaction extends BaseTransaction;\n    protected string name;\n    local int count;\n    function new(string n);\n      name = n;\n      count = 0;\n    endfunction\n  endclass\nendpackage"
}}}
// -----
// Hover over class name 'BaseTransaction' (line 1, col 10)
{"jsonrpc":"2.0","id":1,"method":"textDocument/hover","params":{
  "textDocument":{"uri":"test:///classes.sv"},
  "position":{"line":1,"character":10}
}}
// CHECK:       "id": 1,
// CHECK-NEXT:  "jsonrpc": "2.0",
// CHECK-NEXT:  "result": {
// CHECK-NEXT:    "contents": {
// CHECK-NEXT:      "kind": "markdown",
// CHECK:           "value": "```systemverilog
// CHECK:           class BaseTransaction
// CHECK:           ```
// -----
// Hover over derived class 'MyTransaction' (line 9, col 10)
{"jsonrpc":"2.0","id":2,"method":"textDocument/hover","params":{
  "textDocument":{"uri":"test:///classes.sv"},
  "position":{"line":9,"character":10}
}}
// CHECK:       "id": 2,
// CHECK-NEXT:  "jsonrpc": "2.0",
// CHECK-NEXT:  "result": {
// CHECK-NEXT:    "contents": {
// CHECK-NEXT:      "kind": "markdown",
// CHECK:           "value": "```systemverilog
// CHECK:           class MyTransaction extends BaseTransaction
// CHECK:           ```
// -----
// Hover over protected property 'name' (line 10, col 22)
{"jsonrpc":"2.0","id":3,"method":"textDocument/hover","params":{
  "textDocument":{"uri":"test:///classes.sv"},
  "position":{"line":10,"character":22}
}}
// CHECK:       "id": 3,
// CHECK-NEXT:  "jsonrpc": "2.0",
// CHECK-NEXT:  "result": {
// CHECK-NEXT:    "contents": {
// CHECK-NEXT:      "kind": "markdown",
// CHECK:           "value": "```systemverilog
// CHECK:           protected
// -----
// Hover over method 'display' (line 4, col 19)
{"jsonrpc":"2.0","id":4,"method":"textDocument/hover","params":{
  "textDocument":{"uri":"test:///classes.sv"},
  "position":{"line":4,"character":19}
}}
// CHECK:       "id": 4,
// CHECK-NEXT:  "jsonrpc": "2.0",
// CHECK-NEXT:  "result": {
// CHECK-NEXT:    "contents": {
// CHECK-NEXT:      "kind": "markdown",
// CHECK:           "value": "```systemverilog
// CHECK:           function void display()
// CHECK:           ```"
// -----
{"jsonrpc":"2.0","id":5,"method":"shutdown"}
// -----
{"jsonrpc":"2.0","method":"exit"}
