// RUN: circt-verilog-lsp-server -lit-test < %s | FileCheck %s
// REQUIRES: slang
// Test that diagnostics are published when a document is opened

{"jsonrpc":"2.0","id":0,"method":"initialize","params":{"processId":123,"rootPath":"verilog","capabilities":{},"trace":"off"}}
// -----
{"jsonrpc":"2.0","method":"textDocument/didOpen","params":{"textDocument":{"uri":"test:///test.sv","languageId":"systemverilog","version":1,"text":"module test;\n  wire x\n  // missing semicolon\nendmodule"}}}

// CHECK: "method": "textDocument/publishDiagnostics"
// CHECK-NEXT: "params": {
// CHECK-NEXT:   "diagnostics": [
// CHECK-NEXT:     {
// Diagnostics now include category field
// CHECK:            "category": "Parse Error"
// CHECK:            "message": "expected ';'"
// CHECK:            "severity": 1
// CHECK:            "source": "slang"
// CHECK:          }
// CHECK:        ]
// CHECK:        "uri": "test:///test.sv"
// CHECK:        "version": 1

// -----
{"jsonrpc":"2.0","id":1,"method":"shutdown"}
// -----
{"jsonrpc":"2.0","method":"exit"}
