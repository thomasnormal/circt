// RUN: rm -rf %t
// RUN: mkdir -p %t/bin %t/src
// RUN: touch %t/src/a.sv %t/src/b.sv
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nout=""\nwhile [[ $# -gt 0 ]]; do\n  case "$1" in\n    -o) out="$2"; shift 2 ;;\n    *) shift ;;\n  esac\ndone\n: "${out:?}"\n: > "$out"\nexit 0\n' > %t/bin/circt-verilog
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nmod=""\nfor arg in "$@"; do\n  case "$arg" in\n    --module=*) mod="${arg#--module=}" ;;\n  esac\ndone\nif [[ "$mod" == "top_pass" ]]; then\n  echo "BMC_RESULT=UNSAT"\n  exit 0\nfi\necho "BMC_RESULT=SAT"\nexit 0\n' > %t/bin/circt-bmc
// RUN: chmod +x %t/bin/circt-verilog %t/bin/circt-bmc
// RUN: printf 'pass_case\ttop_pass\t%t/src/a.sv;%t/src/b.sv\t%t/src\t%t/work/pass\nfail_case\ttop_fail\t%t/src/a.sv\t%t/src\t%t/work/fail\n' > %t/cases.tsv
// RUN: not sh -c 'env CIRCT_VERILOG=%t/bin/circt-verilog CIRCT_BMC=%t/bin/circt-bmc BMC_RUN_SMTLIB=0 BMC_PREPARE_CORE_WITH_CIRCT_OPT=0 OUT=%t/results.tsv %S/../../utils/run_pairwise_circt_bmc.py --cases-file %t/cases.tsv --workdir %t/work --results-jsonl-file %t/results.jsonl'
// RUN: python3 -c "import json; rows=[json.loads(line) for line in open('%t/results.jsonl', encoding='utf-8') if line.strip()]; assert len(rows)==2; by={row['case_id']: row for row in rows}; assert by['pass_case']['status']=='PASS'; assert by['pass_case']['suite']=='pairwise'; assert by['pass_case']['mode']=='BMC'; assert by['pass_case']['stage']=='result'; assert by['pass_case']['frontend_time_ms']==0; assert by['pass_case']['solver_time_ms']==0; assert by['pass_case']['log_path'].endswith('/work/pass_case/circt-bmc.log'); assert by['pass_case']['artifact_dir'].endswith('/work/pass_case'); assert by['fail_case']['status']=='FAIL'; assert by['fail_case']['reason_code']=='SAT'; assert by['fail_case']['stage']=='result'; assert by['fail_case']['frontend_time_ms']==0; assert by['fail_case']['solver_time_ms']==0; assert by['fail_case']['log_path'].endswith('/work/fail_case/circt-bmc.log'); assert by['fail_case']['artifact_dir'].endswith('/work/fail_case')"
