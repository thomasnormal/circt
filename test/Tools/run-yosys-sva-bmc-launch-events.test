// RUN: rm -rf %t && mkdir -p %t
// RUN: printf 'module top(input logic clk); assert property (@(posedge clk) 1); endmodule\n' > %t/simple.sv
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nif [[ "$0" == *"circt-verilog-launch-fallback" ]]; then\n  printf "module {\\n  hw.module @top() {}\\n}\\n"\n  exit 0\nfi\necho "failed to run command circt-verilog: Permission denied" >&2\nexit 126\n' > %t/fake-verilog.sh
// RUN: printf '#!/usr/bin/env bash\necho \"Bound reached with no violations!\"\necho \"Assertion can be violated!\"\nexit 0\n' > %t/fake-bmc.sh
// RUN: chmod +x %t/fake-verilog.sh %t/fake-bmc.sh
// RUN: env CIRCT_VERILOG=%t/fake-verilog.sh CIRCT_BMC=%t/fake-bmc.sh Z3_LIB=/dev/null EXPECT_FILE=/dev/null XFAIL_FILE=/dev/null SKIP_VHDL=0 SKIP_FAIL_WITHOUT_MACRO=0 TEST_FILTER='.*' BMC_LAUNCH_RETRY_ATTEMPTS=1 BMC_LAUNCH_RETRY_BACKOFF_SECS=0 BMC_LAUNCH_COPY_FALLBACK=1 BMC_LAUNCH_EVENTS_OUT=%t/launch.tsv KEEP_LOGS_DIR=%t/keep %S/../../utils/run_yosys_sva_circt_bmc.sh %t > %t/run.log
// RUN: FileCheck %s --check-prefix=SUMMARY < %t/run.log
// RUN: FileCheck %s --check-prefix=RETRYLOG < %t/keep/simple_pass.circt-verilog.log
// RUN: FileCheck %s --check-prefix=LAUNCH < %t/launch.tsv
//
// SUMMARY: yosys SVA summary: 1 tests, failures=0, xfail=0, xpass=0, skipped=0
// RETRYLOG: frontend launch retry attempt=1
// RETRYLOG: frontend launch fallback copy=
// LAUNCH: RETRY{{[[:space:]]+}}simple{{[[:space:]]+}}{{.*}}simple.sv{{[[:space:]]+}}frontend{{[[:space:]]+}}{{.*}}fake-verilog.sh{{[[:space:]]+}}retryable_exit_code_126{{[[:space:]]+}}1{{[[:space:]]+}}0.000{{[[:space:]]+}}126
// LAUNCH: FALLBACK{{[[:space:]]+}}simple{{[[:space:]]+}}{{.*}}simple.sv{{[[:space:]]+}}frontend{{[[:space:]]+}}{{.*}}fake-verilog.sh{{[[:space:]]+}}retryable_exit_code_126_retry_exhausted{{[[:space:]]+}}126{{[[:space:]]+}}{{.*}}circt-verilog-launch-fallback
