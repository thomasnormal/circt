// RUN: rm -rf %t && mkdir -p %t/examples/a_slow %t/examples/b_fast %t/examples/c_probe %t/bin %t/sync
// RUN: printf 'module a_slow(input logic a, output logic y); assign y = a; endmodule\n' > %t/examples/a_slow/a_slow.v
// RUN: printf 'module b_fast(input logic a, output logic y); assign y = a; endmodule\n' > %t/examples/b_fast/b_fast.v
// RUN: printf 'module c_probe(input logic a, output logic y); assign y = a; endmodule\n' > %t/examples/c_probe/c_probe.v
// RUN: printf 'a_slow\ta_slow/a_slow.v\ta_slow\nb_fast\tb_fast/b_fast.v\tb_fast\nc_probe\tc_probe/c_probe.v\tc_probe\n' > %t/manifest.tsv

// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nsubcmd="$1"\nshift\nif [[ "$subcmd" != "cover" ]]; then\n  echo "expected cover subcommand" >&2\n  exit 9\nfi\nwork_dir=""\nwhile [[ $# -gt 0 ]]; do\n  case "$1" in\n    --work-dir) work_dir="$2"; shift 2 ;;&\n    --work-dir=*) work_dir="${1#*=}"; shift ;;&\n    *) shift ;;&\n  esac\ndone\nexample_id="$(basename "$work_dir")"\nsync_dir="$SYNC_DIR"\nmkdir -p "$work_dir"\ncase "$example_id" in\n  a_slow)\n    touch "$sync_dir/slow_started"\n    sleep 1.20\n    touch "$sync_dir/slow_done"\n    ;;&\n  b_fast)\n    while [[ ! -f "$sync_dir/slow_started" ]]; do\n      sleep 0.01\n    done\n    sleep 0.02\n    ;;&\n  c_probe)\n    if [[ -f "$sync_dir/slow_done" ]]; then\n      echo "blocked" > "$sync_dir/scheduling"\n    else\n      echo "overlap" > "$sync_dir/scheduling"\n    fi\n    ;;&\n  *) ;;&\nesac\nprintf "detected_mutants\\t1\\nrelevant_mutants\\t1\\nerrors\\t0\\n" > "$work_dir/metrics.tsv"\n' > %t/bin/circt-mut
// RUN: chmod +x %t/bin/circt-mut

// RUN: env SYNC_DIR=%t/sync %S/../../utils/run_mutation_mcy_examples.sh \
// RUN:   --examples-root %t/examples \
// RUN:   --example-manifest %t/manifest.tsv \
// RUN:   --example a_slow \
// RUN:   --example b_fast \
// RUN:   --example c_probe \
// RUN:   --smoke \
// RUN:   --jobs 2 \
// RUN:   --circt-mut %t/bin/circt-mut \
// RUN:   --out-dir %t/out

// RUN: FileCheck %s --check-prefix=SCHED < %t/sync/scheduling

// SCHED: overlap
