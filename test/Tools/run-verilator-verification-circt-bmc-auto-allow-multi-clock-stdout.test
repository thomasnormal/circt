// RUN: rm -rf %t/verilator
// RUN: mkdir -p %t/verilator/tests/asserts %t/bin
// RUN: printf 'module top(input logic clk);\n  assert property (@(posedge clk) 1);\nendmodule\n' > %t/verilator/tests/asserts/single_case.sv
// RUN: printf 'module top(input logic clk_a, input logic clk_b);\n  assert property (@(posedge clk_a) 1);\n  assert property (@(posedge clk_b) 1);\nendmodule\n' > %t/verilator/tests/asserts/multiclock_case.sv
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nlast=\"\"\nfor a in \"$@\"; do last=\"$a\"; done\nif [[ \"$last\" == *multiclock_case.sv ]]; then\n  cat <<\"MLIR\"\nmodule {\n  hw.module @top(in %clk_a : i1, in %clk_b : i1) {\n    %c1 = hw.constant true\n    verif.assert %c1 : i1\n    hw.output\n  }\n}\nMLIR\nelse\n  cat <<\"MLIR\"\nmodule {\n  hw.module @top(in %clk : i1) {\n    %c1 = hw.constant true\n    verif.assert %c1 : i1\n    hw.output\n  }\n}\nMLIR\nfi\n' > %t/bin/circt-verilog
// RUN: chmod +x %t/bin/circt-verilog
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\nallow=0\nmlir=\"\"\nfor a in \"$@\"; do\n  [[ \"$a\" == \"--allow-multi-clock\" ]] && allow=1\n  mlir=\"$a\"\ndone\nif grep -q \"clk_b\" \"$mlir\"; then\n  if [[ \"$allow\" != \"1\" ]]; then\n    echo \"$mlir:1:1: error: modules with multiple clocks not yet supported\"\n    exit 1\n  fi\nelse\n  if [[ \"$allow\" == \"1\" ]]; then\n    echo \"unexpected --allow-multi-clock for single-clock case\" >&2\n    exit 2\n  fi\nfi\necho \"BMC_RESULT=UNSAT\"\nexit 0\n' > %t/bin/circt-bmc
// RUN: chmod +x %t/bin/circt-bmc
// RUN: env CIRCT_VERILOG=%t/bin/circt-verilog CIRCT_BMC=%t/bin/circt-bmc BMC_SMOKE_ONLY=1 TEST_FILTER='single_case|multiclock_case' OUT=%t/results.tsv %S/../../utils/run_verilator_verification_circt_bmc.sh %t/verilator | FileCheck %s --check-prefix=SUMMARY
// RUN: FileCheck %s --check-prefix=RESULTS < %t/results.tsv
//
// SUMMARY: verilator-verification summary: total=2 pass=2 fail=0 xfail=0 xpass=0 error=0 skip=0 unknown=0 timeout=0
// RESULTS-DAG: PASS{{[[:space:]]+}}single_case{{[[:space:]]+}}
// RESULTS-DAG: PASS{{[[:space:]]+}}multiclock_case{{[[:space:]]+}}
