// RUN: rm -rf %t
// RUN: mkdir -p %t/utils %t/utils/opentitan_fpv_policy
// RUN: cp %S/../../utils/run_opentitan_fpv_bmc_policy_workflow.sh %t/utils/run_opentitan_fpv_bmc_policy_workflow.sh
// RUN: cp %S/../../utils/opentitan_fpv_policy/task_profile_status_presets.tsv %t/utils/opentitan_fpv_policy/task_profile_status_presets.tsv
// RUN: printf '#!/usr/bin/env bash\nset -euo pipefail\n: "${ARG_LOG:?}"\n: > "$ARG_LOG"\nfor arg in "$@"; do\n  echo "$arg" >> "$ARG_LOG"\ndone\n' > %t/utils/fake-run-formal-all.sh
// RUN: chmod +x %t/utils/run_opentitan_fpv_bmc_policy_workflow.sh %t/utils/fake-run-formal-all.sh
// RUN: ARG_LOG=%t/update.args %t/utils/run_opentitan_fpv_bmc_policy_workflow.sh --run-formal-all %t/utils/fake-run-formal-all.sh --enable-objective-parity update --out-dir %t/out-update --opentitan-fpv-cfg %t/cfg.hjson --select-cfgs foo_fpv
// RUN: FileCheck %s --check-prefix=UPDATE < %t/update.args
// RUN: ARG_LOG=%t/check.args %t/utils/run_opentitan_fpv_bmc_policy_workflow.sh --run-formal-all %t/utils/fake-run-formal-all.sh --enable-objective-parity --objective-parity-reason-policy all check --out-dir %t/out-check --opentitan-fpv-cfg %t/cfg.hjson --select-cfgs foo_fpv
// RUN: FileCheck %s --check-prefix=CHECK < %t/check.args
// RUN: not sh -c '%t/utils/run_opentitan_fpv_bmc_policy_workflow.sh --run-formal-all %t/utils/fake-run-formal-all.sh --objective-parity-reason-policy all check --out-dir %t/out-invalid --opentitan-fpv-cfg %t/cfg.hjson --select-cfgs foo_fpv > %t/err-policy.txt 2>&1'
// RUN: FileCheck %s --check-prefix=ERR-POLICY < %t/err-policy.txt
// RUN: not sh -c '%t/utils/run_opentitan_fpv_bmc_policy_workflow.sh --run-formal-all %t/utils/fake-run-formal-all.sh --enable-objective-parity update --out-dir %t/out-invalid-managed --opentitan-fpv-cfg %t/cfg.hjson --select-cfgs foo_fpv --opentitan-fpv-objective-parity-baseline-file %t/bad.tsv > %t/err-managed.txt 2>&1'
// RUN: FileCheck %s --check-prefix=ERR-MANAGED < %t/err-managed.txt
//
// UPDATE-DAG: --opentitan-fpv-objective-parity-baseline-file
// UPDATE-DAG: {{.*/}}utils/opentitan_fpv_policy/baselines/opentitan-fpv-bmc-objective-parity-baseline.tsv
// UPDATE-DAG: --opentitan-fpv-objective-parity-reason-policy
// UPDATE-DAG: projected
// UPDATE-DAG: --update-opentitan-fpv-objective-parity-baseline
//
// CHECK-DAG: --opentitan-fpv-objective-parity-baseline-file
// CHECK-DAG: {{.*/}}utils/opentitan_fpv_policy/baselines/opentitan-fpv-bmc-objective-parity-baseline.tsv
// CHECK-DAG: --opentitan-fpv-objective-parity-reason-policy
// CHECK-DAG: all
// CHECK-DAG: --fail-on-opentitan-fpv-objective-parity-drift
//
// ERR-POLICY: --objective-parity-reason-policy requires --enable-objective-parity
// ERR-MANAGED: workflow-managed option must not be passed explicitly: --opentitan-fpv-objective-parity-baseline-file
